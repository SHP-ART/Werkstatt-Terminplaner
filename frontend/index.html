<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Werkstatt Terminplaner</title>
    <!-- SheetJS fÃ¼r Excel-Import (extern, nicht gebÃ¼ndelt) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container">
        <header class="animated-header">
            <div class="header-content">
                <div class="header-icon">
                    <span class="icon-wrench">ğŸ”§</span>
                    <span class="icon-car">ğŸš—</span>
                </div>
                <div class="header-text">
                    <h1>Werkstatt Terminplaner</h1>
                    <p class="header-subtitle">Professionelle Terminverwaltung fÃ¼r Ihre Werkstatt</p>
                </div>
                <div class="header-version" id="appVersion"></div>
                <div class="header-copyright">&copy; Sven Hube</div>
            </div>
            <div class="header-decoration">
                <div class="floating-dot dot-1"></div>
                <div class="floating-dot dot-2"></div>
                <div class="floating-dot dot-3"></div>
            </div>
        </header>

        <div class="tabs">
            <button class="tab-button active" data-tab="dashboard"><span>ğŸ“Š Dashboard</span></button>
            <button class="tab-button" data-tab="heute"><span>ğŸ“… Heute</span></button>
            <button class="tab-button" data-tab="termine"><span>ğŸ—“ï¸ Termine</span></button>
            <button class="tab-button" data-tab="kunden"><span>ğŸ‘¥ Kunden</span></button>
            <button class="tab-button" data-tab="teile-bestellen"><span>ğŸ›’ Teile-Bestellen</span></button>
            <button class="tab-button" data-tab="ersatzautos"><span>ğŸš— Ersatzautos</span></button>
            <button class="tab-button" data-tab="zeitverwaltung"><span>â±ï¸ Zeitverwaltung</span></button>
            <button class="tab-button" data-tab="auslastung"><span>ğŸ“ˆ Auslastung</span></button>
            <button class="tab-button" data-tab="auslastung-dragdrop"><span>ğŸ—ï¸ Planung (Beta)</span></button>
            <button class="tab-button" data-tab="intern"><span>ğŸ‘· Intern</span></button>
            <button class="tab-button" data-tab="papierkorb"><span>ğŸ—‘ï¸ Papierkorb</span></button>
            <button class="tab-button" data-tab="einstellungen"><span>âš™ï¸ Einstellungen</span></button>
        </div>

        <div id="dashboard" class="tab-content active">
            <div class="page-header">
                <h2>ğŸ“Š Dashboard</h2>
                <p class="page-subtitle">Ãœbersicht Ã¼ber Ihre Werkstatt - Termine, Auslastung und mehr</p>
            </div>

            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <div class="card-icon">ğŸ“ˆ</div>
                    <div class="card-content">
                        <h3>Termine Heute</h3>
                        <div class="card-value" id="termineHeute">0</div>
                        <div class="card-detail" id="termineHeuteStatus">Wird geladen...</div>
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-icon">ğŸ“ˆ</div>
                    <div class="card-content">
                        <h3>Auslastung Heute</h3>
                        <div class="card-value" id="auslastungHeute">0%</div>
                        <div class="card-detail" id="auslastungHeuteStatus">Wird geladen...</div>
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-icon">ğŸ“ˆ</div>
                    <div class="card-content">
                        <h3>Kunden & Fahrzeuge</h3>
                        <div class="card-value" id="kundenGesamt">0</div>
                        <div class="card-detail"><span id="fahrzeugeGesamt">0</span> Fahrzeuge</div>
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-icon">ğŸ“ˆ</div>
                    <div class="card-content">
                        <h3>Diese Woche</h3>
                        <div class="card-value" id="termineWoche">0</div>
                        <div class="card-detail">Termine geplant</div>
                    </div>
                </div>
            </div>

            <div class="dashboard-section">
                <h3>Auslastung Heute</h3>
                <div class="auslastung-info" style="margin-bottom: 15px;">
                    <div class="info-item">
                        <span class="label">Geplant:</span>
                        <span id="dashboardGeplant" class="value">0 h</span>
                    </div>
                    <div class="info-item">
                        <span class="label">In Arbeit:</span>
                        <span id="dashboardInArbeit" class="value">0 h</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Abgeschlossen:</span>
                        <span id="dashboardAbgeschlossen" class="value">0 h</span>
                    </div>
                    <div class="info-item">
                        <span class="label">VerfÃ¼gbar:</span>
                        <span id="dashboardVerfuegbar" class="value">8.0 h</span>
                    </div>
                </div>
                <div class="progress-bar">
                    <div id="dashboardProgressGeplant" class="progress-segment progress-geplant" style="width: 0%;"></div>
                    <div id="dashboardProgressInArbeit" class="progress-segment progress-in-arbeit" style="width: 0%;"></div>
                    <div id="dashboardProgressAbgeschlossen" class="progress-segment progress-abgeschlossen" style="width: 0%;"></div>
                    <div id="dashboardProgressEmpty" class="progress-empty" style="position: absolute; width: 100%; text-align: center; line-height: 50px; color: #999; pointer-events: none;">Keine Termine</div>
                </div>
            </div>

            <div class="dashboard-section">
                <h3>Heutige Termine</h3>
                <div class="termine-heute-liste">
                    <table id="dashboardTermineTable">
                        <thead>
                            <tr>
                                <th>Termin-Nr</th>
                                <th>Kunde wartet</th>
                                <th>Bringzeit</th>
                                <th>Abholzeit</th>
                                <th>Kunde</th>
                                <th>Kennzeichen</th>
                                <th>Arbeit</th>
                                <th>Dauer</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="9" class="loading">Termine werden geladen...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="dashboard-section">
                <h3>WochenÃ¼bersicht</h3>
                <div class="wochen-uebersicht">
                    <div class="wochentag-card" id="montag">
                        <div class="wochentag-header">Montag</div>
                        <div class="wochentag-datum"></div>
                        <div class="wochentag-termine">0 Termine</div>
                        <div class="wochentag-auslastung">
                            <div class="mini-progress-bar">
                                <div class="mini-progress-fill" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="wochentag-card" id="dienstag">
                        <div class="wochentag-header">Dienstag</div>
                        <div class="wochentag-datum"></div>
                        <div class="wochentag-termine">0 Termine</div>
                        <div class="wochentag-auslastung">
                            <div class="mini-progress-bar">
                                <div class="mini-progress-fill" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="wochentag-card" id="mittwoch">
                        <div class="wochentag-header">Mittwoch</div>
                        <div class="wochentag-datum"></div>
                        <div class="wochentag-termine">0 Termine</div>
                        <div class="wochentag-auslastung">
                            <div class="mini-progress-bar">
                                <div class="mini-progress-fill" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="wochentag-card" id="donnerstag">
                        <div class="wochentag-header">Donnerstag</div>
                        <div class="wochentag-datum"></div>
                        <div class="wochentag-termine">0 Termine</div>
                        <div class="wochentag-auslastung">
                            <div class="mini-progress-bar">
                                <div class="mini-progress-fill" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="wochentag-card" id="freitag">
                        <div class="wochentag-header">Freitag</div>
                        <div class="wochentag-datum"></div>
                        <div class="wochentag-termine">0 Termine</div>
                        <div class="wochentag-auslastung">
                            <div class="mini-progress-bar">
                                <div class="mini-progress-fill" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="wochentag-card" id="samstag">
                        <div class="wochentag-header">Samstag</div>
                        <div class="wochentag-datum"></div>
                        <div class="wochentag-termine">0 Termine</div>
                        <div class="wochentag-auslastung">
                            <div class="mini-progress-bar">
                                <div class="mini-progress-fill" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="dashboard-section">
                <h3>ğŸ“… MonatsÃ¼bersicht (5 Wochen)</h3>
                <div class="monats-uebersicht" id="monatsUebersicht">
                    <div class="loading">MonatsÃ¼bersicht wird geladen...</div>
                </div>
            </div>

            <!-- Heute fÃ¤llige Ersatzauto-RÃ¼ckgaben -->
            <div class="dashboard-section" id="ersatzautoRueckgabenSection" style="display: none;">
                <h3>ğŸš— Heute fÃ¤llige Ersatzauto-RÃ¼ckgaben</h3>
                <p style="color: #666; margin-bottom: 15px;">Diese Ersatzautos werden heute zurÃ¼ckerwartet</p>
                <div id="ersatzautoRueckgabenListe" class="rueckgaben-liste">
                    <div class="loading">Wird geladen...</div>
                </div>
            </div>
        </div>

        <div id="heute" class="tab-content" data-template-id="tab-template-heute"></div>

        <template id="tab-template-heute">
            <div class="page-header">
                <h2>ğŸ“… Termine Heute</h2>
                <p class="page-subtitle">Ãœbersicht aller heutigen Termine und Aufgaben</p>
            </div>
            
            <div class="heute-info-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <div class="dashboard-card">
                    <div class="card-icon">&#128336;</div>
                    <div class="card-content">
                        <h3>Aktuelle Uhrzeit</h3>
                        <div class="card-value" id="aktuelleUhrzeit" style="font-size: 2em;">--:--</div>
                        <div class="card-detail" id="aktuelleUhrzeitDatum">--</div>
                    </div>
                </div>
                <div class="dashboard-card">
                    <div class="card-icon">&#128200;</div>
                    <div class="card-content">
                        <h3>Auslastung Heute</h3>
                        <div class="card-value" id="heuteAuslastungWert" style="font-size: 2em;">--%</div>
                        <div class="card-detail" id="heuteAuslastungDetail">-- von -- Stunden</div>
                    </div>
                </div>
                <div class="dashboard-card">
                    <div class="card-icon">&#128663;</div>
                    <div class="card-content">
                        <h3>N&auml;chster Kunde</h3>
                        <div class="card-value" id="naechsterKundeZeit" style="font-size: 2em;">--:--</div>
                        <div class="card-detail" id="naechsterKundeInfo">Keine Termine</div>
                    </div>
                </div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <p style="font-size: 16px; color: #666;">
                    <strong>Datum:</strong> <span id="heuteDatum"></span>
                </p>
                <div style="margin-top: 15px; display: flex; gap: 10px;">
                    <button id="heuteTabellenAnsicht" class="btn btn-primary">ğŸ“Š Tabellenansicht</button>
                    <button id="heuteKartenAnsicht" class="btn btn-secondary">ğŸƒ Kartenansicht</button>
                </div>
            </div>

            <div id="heuteTabellenContainer" style="display: block;">
                <h3 class="heute-section-header">ğŸ“‹ Offene Termine</h3>
                <div class="table-scroll-container">
                    <table id="heuteTermineTable">
                        <thead>
                            <tr>
                                <th>Bring</th>
                                <th>Kunde</th>
                                <th>Tel.</th>
                                <th>Kennzeichen</th>
                                <th>Wartet?</th>
                                <th>Arbeit</th>
                                <th>Zeit</th>
                                <th>Status</th>
                                <th>Aktionen</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="9" class="loading">Termine werden geladen...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div id="abgeschlossenSection" class="abgeschlossen-section" style="display: none;">
                    <h3 class="heute-section-header abgeschlossen-header">âœ… Abgeschlossene Termine</h3>
                    <div class="table-scroll-container">
                        <table id="heuteAbgeschlossenTable">
                            <thead>
                                <tr>
                                    <th>Bring</th>
                                    <th>Kunde</th>
                                    <th>Tel.</th>
                                    <th>Kennzeichen</th>
                                    <th>Arbeit</th>
                                    <th>Zeit</th>
                                    <th>Status</th>
                                    <th>Aktionen</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="heuteKartenContainer" style="display: none;">
                <div id="heuteKartenGrid" class="heute-karten-grid">
                    <div class="loading">Termine werden geladen...</div>
                </div>
            </div>
        </template>

        <div id="termine" class="tab-content" data-template-id="tab-template-termine"></div>

        <template id="tab-template-termine">
            <div class="page-header">
                <h2>ğŸ—“ï¸ Terminplanung</h2>
                <p class="page-subtitle">Erstellen und verwalten Sie Termine fÃ¼r Ihre Kunden</p>
            </div>

            <div class="sub-tabs modern-tabs">
                <button class="sub-tab-button active" data-subtab="neuerTermin" onclick="window.switchSubTab('neuerTermin')">
                    <span class="tab-icon">â•</span>
                    <span class="tab-label">Neuer Termin</span>
                </button>
                <button class="sub-tab-button" data-subtab="terminBearbeiten" onclick="window.switchSubTab('terminBearbeiten')">
                    <span class="tab-icon">âœï¸</span>
                    <span class="tab-label">Termin bearbeiten</span>
                </button>
                <button class="sub-tab-button" data-subtab="internerTermin" onclick="window.switchSubTab('internerTermin')">
                    <span class="tab-icon">ğŸ </span>
                    <span class="tab-label">Interner Termin</span>
                </button>
                <button class="sub-tab-button" data-subtab="wartendeAktionen" onclick="window.switchSubTab('wartendeAktionen')">
                    <span class="tab-icon">ğŸ•</span>
                    <span class="tab-label">Wartende Aktionen</span>
                </button>
            </div>

            <div id="neuerTermin" class="sub-tab-content active">
                <div class="form-section">
                    <h3>Neuer Termin</h3>
                    
                    <!-- KI-Assistent Button (nur fÃ¼r OpenAI/ChatGPT) -->
                    <div class="ki-assistent-banner openai-only" id="kiAssistentBanner">
                        <button type="button" class="ki-assistent-btn" id="kiAssistentBtn" title="KI-Assistent fÃ¼r schnelle Terminerstellung (benÃ¶tigt ChatGPT)">
                            <span class="ki-icon">ğŸ¤–</span>
                            <span class="ki-text">KI-Assistent</span>
                            <span class="ki-badge">ChatGPT</span>
                        </button>
                        <span class="ki-hint">Beschreibe den Termin in eigenen Worten!</span>
                    </div>
                    
                    <form id="terminForm">
                    
                    <!-- Verbesserte Kundensuche -->
                    <div class="kunde-suche-bereich">
                        <!-- Namenssuche -->
                        <div class="form-group">
                            <label>ğŸ‘¤ Kundenname suchen:</label>
                            <div class="suche-input-wrapper">
                                <input type="text" id="terminNameSuche" placeholder="z.B. Mustermann, Max..." autocomplete="off">
                                <span id="kundeStatusAnzeige" class="kunde-status-badge" style="display: none;"></span>
                                <div id="nameSucheVorschlaege" class="suche-vorschlaege"></div>
                            </div>
                        </div>
                        
                        <!-- ODER Trenner -->
                        <div class="suche-oder-trenner">
                            <span>oder</span>
                        </div>
                        
                        <!-- Kennzeichen-Suche mit 3 Feldern -->
                        <div class="form-group">
                            <label>ğŸš— Kennzeichen suchen:</label>
                            <div class="kennzeichen-suche-felder">
                                <input type="text" id="kzSucheBezirk" class="kz-feld kz-bezirk" placeholder="OSL" maxlength="3" autocomplete="off">
                                <div class="kz-siegel"></div>
                                <input type="text" id="kzSucheBuchstaben" class="kz-feld kz-buchstaben" placeholder="KI" maxlength="2" autocomplete="off">
                                <input type="text" id="kzSucheNummer" class="kz-feld kz-nummer" placeholder="123" maxlength="4" autocomplete="off">
                            </div>
                            <div id="kennzeichenSucheVorschlaege" class="suche-vorschlaege kennzeichen-vorschlaege"></div>
                            <small class="kz-hinweis">ğŸ’¡ Jedes Feld durchsucht separat - auch Teileingaben mÃ¶glich!</small>
                        </div>
                    </div>

                    <!-- Gefundener Kunde Anzeige -->
                    <div id="gefundenerKundeAnzeige" class="kunde-gefunden-box" style="display: none; margin-bottom: 15px; padding: 12px 15px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%); border-radius: 8px; border-left: 4px solid #4caf50;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <span style="font-weight: 600; color: #2e7d32;">ğŸ‘¤ Kunde gefunden:</span>
                                <span id="gefundenerKundeName" style="font-size: 1.1em; font-weight: bold; color: #1b5e20; margin-left: 8px;"></span>
                            </div>
                            <span id="gefundenerKundeTelefon" style="color: #666; font-size: 0.9em;"></span>
                        </div>
                    </div>

                    <input type="hidden" id="kunde_id">
                    <input type="hidden" id="kundeNameInput">
                    <input type="hidden" id="kundenListe">

                    <!-- Datum-Auswahl - MIT INTEGRIERTEM KALENDER -->
                    <div class="form-section datum-kalender-section" style="margin-top: 20px; margin-bottom: 20px; padding: 20px; background: linear-gradient(135deg, #e3f2fd 0%, #f0f7ff 100%); border-radius: 12px; border: 3px solid #2196f3; box-shadow: 0 4px 12px rgba(33, 150, 243, 0.15);">
                        <label style="font-size: 1.2em; font-weight: 700; color: #1565c0; display: block; margin-bottom: 15px;">
                            ğŸ“… Termin-Datum wÃ¤hlen: *
                        </label>
                        <!-- Verstecktes Datum-Input fÃ¼r Formular-Validierung -->
                        <input type="date" id="datum" required style="position: absolute; opacity: 0; pointer-events: none;">
                        
                        <!-- AusgewÃ¤hltes Datum Anzeige -->
                        <div id="selectedDatumDisplay" style="text-align: center; font-size: 1.3em; font-weight: 700; color: #1565c0; margin-bottom: 15px; padding: 10px; background: white; border-radius: 8px; border: 2px solid #2196f3;">
                            Bitte Datum wÃ¤hlen...
                        </div>
                        
                        <!-- Inline Kalender mit Auslastung (immer sichtbar) -->
                        <div id="auslastungKalenderInline" class="auslastung-kalender-inline">
                            <div class="kalender-header">
                                <button type="button" class="kalender-nav-btn" id="kalenderPrevMonth">â—€</button>
                                <span id="kalenderMonatJahr">Januar 2025</span>
                                <button type="button" class="kalender-nav-btn" id="kalenderNextMonth">â–¶</button>
                            </div>
                            <div class="kalender-legende">
                                <span class="legende-item"><span class="legende-farbe legende-gruen"></span>0-50%</span>
                                <span class="legende-item"><span class="legende-farbe legende-gelb"></span>51-80%</span>
                                <span class="legende-item"><span class="legende-farbe legende-orange"></span>81-100%</span>
                                <span class="legende-item"><span class="legende-farbe legende-rot"></span>&gt;100%</span>
                            </div>
                            <div class="kalender-wochentage">
                                <span>Mo</span><span>Di</span><span>Mi</span><span>Do</span><span>Fr</span><span>Sa</span><span>So</span>
                            </div>
                            <div id="kalenderTage" class="kalender-tage">
                                <!-- Tage werden dynamisch gefÃ¼llt -->
                            </div>
                            <div class="kalender-footer" style="margin-top: 10px; display: flex; justify-content: center;">
                                <button type="button" class="btn btn-primary" id="kalenderHeuteBtn" style="padding: 8px 20px;">ğŸ“… Heute</button>
                            </div>
                        </div>
                    </div>

                    <div id="terminAuslastungAnzeige" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #4a90e2; display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <strong style="font-size: 1.1em;">Auslastung fÃ¼r gewÃ¤hltes Datum</strong>
                            <span id="terminAuslastungProzent" style="font-size: 1.2em; font-weight: bold; color: #4a90e2;">-</span>
                        </div>
                        <div style="background: #e9ecef; border-radius: 5px; height: 20px; overflow: hidden; margin-bottom: 10px;">
                            <div id="terminAuslastungBalken" style="background: #4a90e2; height: 100%; width: 0%; transition: width 0.3s, background 0.3s;"></div>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; font-size: 0.9em;">
                            <div>
                                <span style="color: #666;">VerfÃ¼gbar:</span>
                                <strong id="terminAuslastungVerfuegbar">-</strong>
                            </div>
                            <div>
                                <span style="color: #666;">Gesamt:</span>
                                <strong id="terminAuslastungGesamt">-</strong>
                            </div>
                        </div>
                        
                        <!-- Termine fÃ¼r diesen Tag -->
                        <div id="newTermineAmTag" style="margin-top: 15px; padding-top: 12px; border-top: 1px solid #dee2e6;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <strong style="color: #1565c0;">ğŸ“‹ Termine an diesem Tag:</strong>
                                <span id="newTermineAnzahl" style="font-size: 0.85em; color: #666;">0 Termine</span>
                            </div>
                            <div id="newTermineListe" style="max-height: 200px; overflow-y: auto; font-size: 0.85em;">
                                <!-- Termine werden hier dynamisch eingefÃ¼gt -->
                            </div>
                        </div>
                    </div>

                    <!-- Telefon fÃ¼r neuen Kunden -->
                    <div class="form-section" style="margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); border-radius: 8px; border-left: 4px solid #ff9800;">
                        <label style="font-weight: 600; color: #e65100; display: block; margin-bottom: 8px;">
                            ğŸ“ Telefon (optional, bei neuem Kunden):
                        </label>
                        <input type="tel" id="neuer_kunde_telefon" placeholder="Telefonnummer (optional)" style="width: 100%; padding: 10px; border: 2px solid #ff9800; border-radius: 6px; font-size: 1em;">
                        <small style="display: block; color: #e65100; margin-top: 5px;">
                            Nur ausfÃ¼llen, wenn ein neuer Kunde ohne vorhandene Telefonnummer angelegt wird
                        </small>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Kennzeichen: *</label>
                            <input type="text" id="kennzeichen" required placeholder="z.B. B-AB 1234">
                        </div>
                        <div class="form-group">
                            <label>Kilometerstand:</label>
                            <input type="number" id="kilometerstand" min="0" placeholder="z.B. 128000">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>VIN/FIN (Fahrzeug-Ident-Nr.):</label>
                            <div class="vin-input-wrapper">
                                <input type="text" id="vin" maxlength="17" placeholder="z.B. VF7SX5F55GW123456" style="text-transform: uppercase;">
                                <button type="button" id="vinDecodeBtn" class="vin-decode-btn" title="VIN dekodieren">ğŸ”</button>
                            </div>
                            <div id="vinInfoBereich" class="vin-info-bereich" style="display: none;"></div>
                        </div>
                        <div class="form-group">
                            <label>Fahrzeugtyp:</label>
                            <input type="text" id="fahrzeugtyp" placeholder="z.B. CitroÃ«n C3, Berlingo">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group" style="position: relative; flex: 2;">
                            <div class="arbeiten-label-row">
                                <label>Arbeiten (jede Zeile eine Arbeit):</label>
                                <label class="ki-analyse-toggle ki-element" title="KI analysiert Problembeschreibungen und schlÃ¤gt passende Arbeiten vor">
                                    <input type="checkbox" id="kiAnalyseAktiv">
                                    <span class="ki-toggle-icon">ğŸ¤–</span>
                                    <span class="ki-toggle-text">KI-Hilfe</span>
                                </label>
                            </div>
                            <textarea id="arbeitEingabe" class="arbeiten-textarea" rows="5" placeholder="z.B.&#10;Ã–lwechsel&#10;Bremsen vorne&#10;Inspektion" required autocomplete="off"></textarea>
                            <div id="arbeitAutocomplete" class="autocomplete-dropdown"></div>
                            <datalist id="arbeitListe"></datalist>
                            
                            <!-- KI-VorschlÃ¤ge Bereich -->
                            <div id="kiVorschlaegeBereich" class="ki-vorschlaege-bereich ki-element" style="display: none;">
                                <div class="ki-vorschlaege-header">
                                    <span class="ki-vorschlaege-icon">ğŸ¤–</span>
                                    <span class="ki-vorschlaege-titel">KI-VorschlÃ¤ge</span>
                                    <button type="button" class="ki-vorschlaege-close" id="kiVorschlaegeClose">Ã—</button>
                                </div>
                                <div id="kiVorschlaegeListe" class="ki-vorschlaege-liste"></div>
                                <div class="ki-vorschlaege-footer">
                                    <small>Klicke auf einen Vorschlag um ihn zu Ã¼bernehmen</small>
                                </div>
                            </div>
                            
                            <!-- GeschÃ¤tzte Zeit Anzeige -->
                            <div id="zeitschaetzungAnzeige" style="margin-top: 10px; padding: 12px; background: linear-gradient(135deg, #e8f4fd 0%, #f0f7ff 100%); border-radius: 8px; border-left: 4px solid #4a90e2; display: none;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="font-weight: 600; color: #333;">â±ï¸ GeschÃ¤tzte Gesamtzeit:</span>
                                    <span id="zeitschaetzungWert" style="font-size: 1.3em; font-weight: bold; color: #4a90e2;">0 h</span>
                                </div>
                                <div id="zeitschaetzungDetails" style="margin-top: 8px; font-size: 0.9em; color: #666;"></div>
                            </div>
                        </div>
                        
                        <!-- Ersatzauto Bereich rechts neben Arbeiten -->
                        <div class="form-group" style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                            <div class="checkbox-group">
                                <label>Ersatzauto gewÃ¼nscht?</label>
                                <label class="checkbox-inline">
                                    <input type="checkbox" id="ersatzauto"> Ja
                                </label>
                                <span id="ersatzautoStatus" class="ersatzauto-status" style="display: none;">
                                    <span class="status-indicator"></span>
                                    <span class="status-text"></span>
                                </span>
                            </div>
                            
                            <!-- Ersatzauto Dauer-Felder -->
                            <div id="ersatzautoDauerGroup" class="ersatzauto-dauer-section" style="display: none; padding: 12px; background: #fff8e1; border-radius: 8px; border-left: 4px solid #ffc107;">
                                <h4 style="margin: 0 0 8px 0; font-size: 0.9rem; color: #856404;">ğŸš— Ersatzauto-Zeitraum</h4>
                                <div style="margin: 0;">
                                    <label style="font-size: 0.85rem;">Dauer (Tage):</label>
                                    <input type="number" id="ersatzauto_tage" min="1" max="30" placeholder="z.B. 1, 2, 3..." style="width: 100%; margin-top: 4px;">
                                    <small style="color: #666; display: block; margin-top: 4px; font-size: 0.8rem;">Ersatzwagen wird blockiert</small>
                                </div>
                                <p id="ersatzautoDauerHinweis" style="margin: 8px 0 0 0; font-size: 0.75rem; color: #856404;">
                                    ğŸ’¡ Bei tel. RÃ¼cksprache Tage angeben, sonst Abholdatum.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Teile bestellen - Eigene Sektion -->
                    <div class="form-section teile-bestellen-section" style="margin-top: 15px; padding: 15px; background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); border-radius: 8px; border-left: 4px solid #ff9800;">
                        <label class="checkbox-inline" style="display: flex; align-items: center; gap: 10px; cursor: pointer; margin: 0;">
                            <input type="checkbox" id="teileBestellenCheckbox" style="width: 20px; height: 20px; accent-color: #e65100;">
                            <span style="font-size: 1.1em; font-weight: 600; color: #e65100;">âš ï¸ Teile bestellen / Bestand prÃ¼fen</span>
                        </label>
                        <p style="margin: 10px 0 0 30px; font-size: 0.85em; color: #bf360c;">
                            ğŸ“¦ Markiert alle Arbeiten mit "Muss bestellt werden" â†’ erscheint in der Teile-Status Ãœbersicht
                        </p>
                    </div>

                    <div class="form-group">
                        <label>Umfang/Details:</label>
                        <textarea id="umfang" rows="3" placeholder="ZusÃ¤tzliche Informationen..."></textarea>
                    </div>

                    <div class="form-group service-art-auswahl">
                        <label>Fahrzeug Abholung/Lieferung:</label>
                        <div class="service-art-checkboxen">
                            <label class="service-art-option">
                                <input type="radio" name="abholung_typ" value="bringen" checked>
                                <span class="service-art-label">ğŸš— Holt/bringt selbst</span>
                            </label>
                            <label class="service-art-option">
                                <input type="radio" name="abholung_typ" value="hol_bring">
                                <span class="service-art-label">ğŸšš Hol-/Bring-Service</span>
                            </label>
                            <label class="service-art-option">
                                <input type="radio" name="abholung_typ" value="warten">
                                <span class="service-art-label">â³ Kunde wartet</span>
                            </label>
                            <label class="service-art-option">
                                <input type="radio" name="abholung_typ" value="ruecksprache">
                                <span class="service-art-label">ğŸ“ Telefonische RÃ¼cksprache</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group" id="abholungDetailsGroup" style="display: none;">
                        <label>Details zur Abholung/Lieferung:</label>
                        <textarea id="abholung_details" rows="2" placeholder="z.B. Adresse, Uhrzeit, besondere Hinweise..."></textarea>
                    </div>

                    <div class="form-row" id="abholungZeitRow" style="display: none;">
                        <div class="form-group" id="bringzeitGroup">
                            <label>Bringzeit:</label>
                            <input type="text" id="bring_zeit" placeholder="HH:MM" pattern="[0-2][0-9]:[0-5][0-9]" maxlength="5" title="24h-Format (z.B. 08:00, 14:30)" oninput="this.value = this.value.replace(/[^0-9:]/g, ''); if(this.value.length === 2 && !this.value.includes(':')) this.value += ':';" style="text-align: center;">
                            <div id="bringzeitHinweis" class="bringzeit-hinweis" style="display: none;"></div>
                        </div>
                        <div class="form-group" id="abholzeitGroup">
                            <label>Abholzeit:</label>
                            <input type="text" id="abholung_zeit" placeholder="HH:MM" pattern="[0-2][0-9]:[0-5][0-9]" maxlength="5" title="24h-Format (z.B. 16:00, 17:30)" oninput="this.value = this.value.replace(/[^0-9:]/g, ''); if(this.value.length === 2 && !this.value.includes(':')) this.value += ':';" style="text-align: center;">
                        </div>
                        <div class="form-group" id="abholDatumGroup">
                            <label>Abhol-Datum:</label>
                            <input type="date" id="abholung_datum">
                            <small style="color: #666;">Falls anderer Tag als Termin</small>
                        </div>
                        <div class="form-group" id="kontaktOptionGroup">
                            <label>Kontakt:</label>
                            <div style="display: flex; gap: 15px; align-items: center;">
                                <label class="checkbox-inline">
                                    <input type="checkbox" id="kontakt_kunde_anrufen"> Kunde anrufen
                                </label>
                                <label class="checkbox-inline">
                                    <input type="checkbox" id="kontakt_kunde_ruft"> Kunde ruft selbst an
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Phasen fÃ¼r mehrtÃ¤gige Arbeiten (z.B. Unfallreparatur) -->
                    <div id="phasenSection" class="form-section" style="margin-top: 20px; padding: 15px; background: #fff3e0; border-radius: 8px; border-left: 4px solid #ff9800; display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4 style="margin: 0; color: #e65100;">ğŸ”§ Arbeitsphasen (mehrtÃ¤gig)</h4>
                            <button type="button" class="btn btn-secondary" id="addPhaseBtn" style="padding: 5px 10px; font-size: 0.9em;">+ Phase hinzufÃ¼gen</button>
                        </div>
                        <p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">FÃ¼r Unfallreparaturen oder mehrtÃ¤gige Arbeiten: Jede Phase kann ein eigenes Datum haben.</p>
                        <div id="phasenListe"></div>
                        
                        <!-- Option fÃ¼r automatische Folgetermine -->
                        <div style="margin-top: 15px; padding: 12px; background: #e8f5e9; border-radius: 6px; border: 1px solid #a5d6a7;">
                            <label class="checkbox-inline" style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" id="erstelleFolgetermineCheckbox" checked>
                                <span style="font-weight: 500; color: #2e7d32;">ğŸ“… Automatisch Folgetermine fÃ¼r jede Phase erstellen</span>
                            </label>
                            <p style="color: #666; font-size: 0.85em; margin: 8px 0 0 24px;">Jede Phase wird als separater Termin mit gleichem Kunden/Kennzeichen erstellt. Die Termine werden verknÃ¼pft angezeigt.</p>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 15px;">
                        <label class="checkbox-inline">
                            <input type="checkbox" id="mehrtaegigCheckbox"> MehrtÃ¤gige Arbeit (Phasen aktivieren)
                        </label>
                    </div>

                    <button type="submit" class="btn-sparkle">
                        <svg class="sparkle-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 0L14.59 9.41L24 12L14.59 14.59L12 24L9.41 14.59L0 12L9.41 9.41L12 0Z"/>
                        </svg>
                        <span class="btn-text">Termin erstellen</span>
                        <div class="dots-border"></div>
                    </button>
                </form>
                </div><!-- Ende form-section -->

                <div class="info-box" style="margin-top: 20px; padding: 15px; background: #e3f2fd; border-radius: 8px;">
                    <p>âœ… <strong>Termin erstellt!</strong></p>
                    <p>Gehen Sie zu <strong>"Zeitverwaltung"</strong>, um die Zeiten fÃ¼r einzelne Arbeiten zu bearbeiten.</p>
                </div>
            </div><!-- Ende neuerTermin -->

            <div id="terminBearbeiten" class="sub-tab-content">
                <div class="form-section">
                    <h3>Termin bearbeiten</h3>
                    <p style="color: #666; margin-bottom: 20px;">WÃ¤hlen Sie einen Termin aus, um ihn zu bearbeiten.</p>
                    
                    <!-- Datum-Auswahl mit Kalender fÃ¼r Terminsuche -->
                    <div class="form-section datum-kalender-section" style="margin-bottom: 20px; padding: 20px; background: linear-gradient(135deg, #e3f2fd 0%, #f0f7ff 100%); border-radius: 12px; border: 3px solid #2196f3; box-shadow: 0 4px 12px rgba(33, 150, 243, 0.15);">
                        <label style="font-size: 1.2em; font-weight: 700; color: #1565c0; display: block; margin-bottom: 15px;">
                            ğŸ“… Datum fÃ¼r Terminsuche wÃ¤hlen:
                        </label>
                        <!-- Verstecktes Datum-Input fÃ¼r Formular-Logik -->
                        <input type="date" id="editTerminDatum" style="position: absolute; opacity: 0; pointer-events: none;">
                        
                        <!-- AusgewÃ¤hltes Datum Anzeige -->
                        <div id="editSuchDatumDisplay" style="text-align: center; font-size: 1.3em; font-weight: 700; color: #1565c0; margin-bottom: 15px; padding: 10px; background: white; border-radius: 8px; border: 2px solid #2196f3;">
                            Bitte Datum wÃ¤hlen...
                        </div>
                        
                        <!-- Inline Kalender mit Auslastung fÃ¼r Suche -->
                        <div id="editSuchKalenderInline" class="auslastung-kalender-inline">
                            <div class="kalender-header">
                                <button type="button" class="kalender-nav-btn" id="editSuchKalenderPrevMonth">â—€</button>
                                <span id="editSuchKalenderMonatJahr">Januar 2025</span>
                                <button type="button" class="kalender-nav-btn" id="editSuchKalenderNextMonth">â–¶</button>
                            </div>
                            <div class="kalender-legende">
                                <span class="legende-item"><span class="legende-farbe legende-gruen"></span>0-50%</span>
                                <span class="legende-item"><span class="legende-farbe legende-gelb"></span>51-80%</span>
                                <span class="legende-item"><span class="legende-farbe legende-orange"></span>81-100%</span>
                                <span class="legende-item"><span class="legende-farbe legende-rot"></span>&gt;100%</span>
                            </div>
                            <div class="kalender-wochentage">
                                <span>Mo</span><span>Di</span><span>Mi</span><span>Do</span><span>Fr</span><span>Sa</span><span>So</span>
                            </div>
                            <div id="editSuchKalenderTage" class="kalender-tage">
                                <!-- Tage werden dynamisch gefÃ¼llt -->
                            </div>
                            <div class="kalender-footer" style="margin-top: 10px; display: flex; justify-content: center;">
                                <button type="button" class="btn btn-primary" id="editSuchKalenderHeuteBtn" style="padding: 8px 20px;">ğŸ“… Heute</button>
                            </div>
                        </div>
                    </div>

                    <!-- Termin-Liste (klickbar) -->
                    <div id="editTerminListeContainer" style="margin-bottom: 20px;">
                        <label style="font-weight: 600; margin-bottom: 10px; display: block;">ğŸ“‹ Termine an diesem Tag:</label>
                        <div id="editTerminListe" style="max-height: 350px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 8px; background: #fff;">
                            <div style="padding: 20px; text-align: center; color: #666;">
                                Bitte wÃ¤hlen Sie zuerst ein Datum im Kalender
                            </div>
                        </div>
                    </div>

                    <!-- Bearbeitungsformular (zunÃ¤chst ausgeblendet) -->
                    <div id="editTerminFormContainer" style="display: none;">
                        <form id="terminEditForm">
                            <input type="hidden" id="edit_termin_id">
                            <input type="hidden" id="edit_kunde_id">
                            
                            <!-- Kunde Anzeige -->
                            <div id="editGefundenerKundeAnzeige" class="kunde-gefunden-box" style="margin-bottom: 15px; padding: 12px 15px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%); border-radius: 8px; border-left: 4px solid #4caf50;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <span style="font-weight: 600; color: #2e7d32;">ğŸ‘¤ Kunde:</span>
                                        <span id="edit_kunde_name_display" style="font-size: 1.1em; font-weight: bold; color: #1b5e20; margin-left: 8px;"></span>
                                    </div>
                                    <span id="edit_kunde_telefon_display" style="color: #666; font-size: 0.9em;"></span>
                                </div>
                            </div>

                            <!-- Datum-Auswahl - MIT INTEGRIERTEM KALENDER (Edit) -->
                            <div class="form-section datum-kalender-section" style="margin-top: 10px; margin-bottom: 20px; padding: 20px; background: linear-gradient(135deg, #e3f2fd 0%, #f0f7ff 100%); border-radius: 12px; border: 3px solid #2196f3; box-shadow: 0 4px 12px rgba(33, 150, 243, 0.15);">
                                <label style="font-size: 1.2em; font-weight: 700; color: #1565c0; display: block; margin-bottom: 15px;">
                                    ğŸ“… Termin-Datum wÃ¤hlen: *
                                </label>
                                <!-- Verstecktes Datum-Input fÃ¼r Formular-Validierung -->
                                <input type="date" id="edit_datum" required style="position: absolute; opacity: 0; pointer-events: none;">
                                
                                <!-- AusgewÃ¤hltes Datum Anzeige -->
                                <div id="editSelectedDatumDisplay" style="text-align: center; font-size: 1.3em; font-weight: 700; color: #1565c0; margin-bottom: 15px; padding: 10px; background: white; border-radius: 8px; border: 2px solid #2196f3;">
                                    Bitte Datum wÃ¤hlen...
                                </div>
                                
                                <!-- Inline Kalender mit Auslastung (immer sichtbar) -->
                                <div id="editAuslastungKalenderInline" class="auslastung-kalender-inline">
                                    <div class="kalender-header">
                                        <button type="button" class="kalender-nav-btn" id="editKalenderPrevMonth">â—€</button>
                                        <span id="editKalenderMonatJahr">Januar 2025</span>
                                        <button type="button" class="kalender-nav-btn" id="editKalenderNextMonth">â–¶</button>
                                    </div>
                                    <div class="kalender-legende">
                                        <span class="legende-item"><span class="legende-farbe legende-gruen"></span>0-50%</span>
                                        <span class="legende-item"><span class="legende-farbe legende-gelb"></span>51-80%</span>
                                        <span class="legende-item"><span class="legende-farbe legende-orange"></span>81-100%</span>
                                        <span class="legende-item"><span class="legende-farbe legende-rot"></span>&gt;100%</span>
                                    </div>
                                    <div class="kalender-wochentage">
                                        <span>Mo</span><span>Di</span><span>Mi</span><span>Do</span><span>Fr</span><span>Sa</span><span>So</span>
                                    </div>
                                    <div id="editKalenderTage" class="kalender-tage">
                                        <!-- Tage werden dynamisch gefÃ¼llt -->
                                    </div>
                                    <div class="kalender-footer" style="margin-top: 10px; display: flex; justify-content: center;">
                                        <button type="button" class="btn btn-primary" id="editKalenderHeuteBtn" style="padding: 8px 20px;">ğŸ“… Heute</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Auslastungsanzeige ausgeblendet - redundant da Termine bereits in der Liste oben angezeigt werden -->
                            <div id="editTerminAuslastungAnzeige" style="display: none !important;">
                                <!-- Diese Box wird nicht mehr benÃ¶tigt -->
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Kennzeichen: *</label>
                                    <input type="text" id="edit_kennzeichen" required placeholder="z.B. B-AB 1234">
                                </div>
                                <div class="form-group">
                                    <label>Kilometerstand:</label>
                                    <input type="number" id="edit_kilometerstand" min="0" placeholder="z.B. 128000">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>VIN/FIN (Fahrzeug-Ident-Nr.):</label>
                                    <input type="text" id="edit_vin" maxlength="17" placeholder="z.B. WVWZZZ3CZWE123456" style="text-transform: uppercase;">
                                </div>
                                <div class="form-group">
                                    <label>Fahrzeugtyp:</label>
                                    <input type="text" id="edit_fahrzeugtyp" placeholder="z.B. VW Golf 7, BMW 320d">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group" style="position: relative;">
                                    <label>Arbeiten (jede Zeile eine Arbeit):</label>
                                    <textarea id="edit_arbeitEingabe" class="arbeiten-textarea" rows="5" placeholder="z.B.&#10;Ã–lwechsel&#10;Bremsen vorne&#10;Inspektion" required autocomplete="off"></textarea>
                                    
                                    <!-- GeschÃ¤tzte Zeit Anzeige -->
                                    <div id="editZeitschaetzungAnzeige" style="margin-top: 10px; padding: 12px; background: linear-gradient(135deg, #e8f4fd 0%, #f0f7ff 100%); border-radius: 8px; border-left: 4px solid #4a90e2; display: none;">
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <span style="font-weight: 600; color: #333;">â±ï¸ GeschÃ¤tzte Gesamtzeit:</span>
                                            <span id="editZeitschaetzungWert" style="font-size: 1.3em; font-weight: bold; color: #4a90e2;">0 h</span>
                                        </div>
                                        <div id="editZeitschaetzungDetails" style="margin-top: 8px; font-size: 0.9em; color: #666;"></div>
                                    </div>
                                </div>
                                <div class="form-group checkbox-group">
                                    <label>Ersatzauto gewÃ¼nscht?</label>
                                    <label class="checkbox-inline">
                                        <input type="checkbox" id="edit_ersatzauto"> Ja
                                    </label>
                                    <span id="editErsatzautoStatus" class="ersatzauto-status" style="display: none;">
                                        <span class="status-indicator"></span>
                                        <span class="status-text"></span>
                                    </span>
                                </div>
                                
                                <!-- Ersatzauto Dauer-Felder -->
                                <div id="editErsatzautoDauerGroup" class="form-section ersatzauto-dauer-section" style="display: none; margin-top: 15px; padding: 15px; background: #fff8e1; border-radius: 8px; border-left: 4px solid #ffc107;">
                                    <h4 style="margin: 0 0 10px 0; font-size: 0.95rem; color: #856404;">ğŸš— Ersatzauto-Zeitraum</h4>
                                    <div class="form-group" style="margin: 0;">
                                        <label>GeschÃ¤tzte Dauer (Tage):</label>
                                        <input type="number" id="edit_ersatzauto_tage" min="1" max="30" placeholder="z.B. 1, 2, 3..." style="max-width: 150px;">
                                        <small style="color: #666; display: block; margin-top: 5px;">Ersatzwagen wird fÃ¼r diese Anzahl Tage blockiert</small>
                                    </div>
                                    <p id="editErsatzautoDauerHinweis" style="margin: 12px 0 0 0; font-size: 0.85rem; color: #856404;">
                                        ğŸ’¡ <strong>Hinweis:</strong> Bei tel. RÃ¼cksprache Anzahl Tage angeben. Sonst wird das Abholdatum unten verwendet.
                                    </p>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Umfang/Details:</label>
                                <textarea id="edit_umfang" rows="3" placeholder="ZusÃ¤tzliche Informationen..."></textarea>
                            </div>

                            <div class="form-group">
                                <label>Fahrzeug Abholung/Lieferung:</label>
                                <select id="edit_abholung_typ">
                                    <option value="bringen">Kunde bringt/holt selbst</option>
                                    <option value="hol_bring">Hol- und Bringservice</option>
                                    <option value="ruecksprache">Telefonische RÃ¼cksprache</option>
                                    <option value="warten">Kunde wartet</option>
                                </select>
                            </div>

                            <div class="form-group" id="editAbholungDetailsGroup" style="display: none;">
                                <label>Details zur Abholung/Lieferung:</label>
                                <textarea id="edit_abholung_details" rows="2" placeholder="z.B. Adresse, Uhrzeit, besondere Hinweise..."></textarea>
                            </div>

                            <div class="form-row" id="editAbholungZeitRow" style="display: none;">
                                <div class="form-group" id="editBringzeitGroup">
                                    <label>Bringzeit:</label>
                                    <input type="text" id="edit_bring_zeit" placeholder="HH:MM" pattern="[0-2][0-9]:[0-5][0-9]" maxlength="5" title="24h-Format (z.B. 08:00, 14:30)" oninput="this.value = this.value.replace(/[^0-9:]/g, ''); if(this.value.length === 2 && !this.value.includes(':')) this.value += ':';" style="text-align: center;">
                                    <div id="editBringzeitHinweis" class="bringzeit-hinweis" style="display: none;"></div>
                                </div>
                                <div class="form-group" id="editAbholzeitGroup">
                                    <label>Abholzeit:</label>
                                    <input type="text" id="edit_abholung_zeit" placeholder="HH:MM" pattern="[0-2][0-9]:[0-5][0-9]" maxlength="5" title="24h-Format (z.B. 16:00, 17:30)" oninput="this.value = this.value.replace(/[^0-9:]/g, ''); if(this.value.length === 2 && !this.value.includes(':')) this.value += ':';" style="text-align: center;">
                                </div>
                                <div class="form-group" id="editAbholDatumGroup">
                                    <label>Abhol-Datum:</label>
                                    <input type="date" id="edit_abholung_datum">
                                    <small style="color: #666;">Falls anderer Tag als Termin</small>
                                </div>
                                <div class="form-group" id="editKontaktOptionGroup">
                                    <label>Kontakt:</label>
                                    <div style="display: flex; gap: 15px; align-items: center;">
                                        <label class="checkbox-inline">
                                            <input type="checkbox" id="edit_kontakt_kunde_anrufen"> Kunde anrufen
                                        </label>
                                        <label class="checkbox-inline">
                                            <input type="checkbox" id="edit_kontakt_kunde_ruft"> Kunde ruft selbst an
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div style="display: flex; gap: 10px;">
                                <button type="submit" class="btn btn-primary">Ã„nderungen speichern</button>
                                <button type="button" class="btn btn-secondary" id="editTerminAbbrechenBtn">Abbrechen</button>
                            </div>
                        </form>
                    </div>

                    <div id="editTerminKeinAusgewaehlt" style="padding: 40px; text-align: center; color: #666;">
                        <p style="font-size: 18px;">ğŸ“‹ WÃ¤hlen Sie ein Datum und einen Termin aus der Liste</p>
                        <p>Nach der Auswahl kÃ¶nnen Sie alle Termindetails bearbeiten.</p>
                    </div>
                </div>
            </div>

            <div id="internerTermin" class="sub-tab-content">
                <!-- Neuen internen Termin erstellen -->
                <div class="form-section">
                    <h3>â• Neuen internen Termin erstellen</h3>
                    <p style="color: #666; margin-bottom: 20px;">FÃ¼r interne Arbeiten wie Autoaufbereitung, Waschen, etc.</p>
                    <form id="internerTerminForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Interne Auftragsnummer (optional):</label>
                                <input type="text" id="intern_auftragsnummer" placeholder="z.B. INT-2026-001" maxlength="50">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Arbeitsumfang: *</label>
                            <textarea id="intern_arbeit" rows="4" required placeholder="z.B.&#10;Autoaufbereitung&#10;Waschen&#10;Polieren"></textarea>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Datum: *</label>
                                <input type="date" id="intern_datum" required>
                            </div>
                            <div class="form-group">
                                <label>GeschÃ¤tzte Zeit (Stunden):</label>
                                <input type="number" id="intern_zeit" min="0.25" step="0.25" placeholder="z.B. 2.5">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Startzeit (optional):</label>
                                <input type="text" id="intern_zeit_von" placeholder="HH:MM" pattern="[0-2][0-9]:[0-5][0-9]" maxlength="5" title="24h-Format (z.B. 08:00)" oninput="this.value = this.value.replace(/[^0-9:]/g, ''); if(this.value.length === 2 && !this.value.includes(':')) this.value += ':';" style="text-align: center;">
                            </div>
                            <div class="form-group">
                                <label>Fertig bis (optional):</label>
                                <input type="text" id="intern_zeit_bis" placeholder="HH:MM" pattern="[0-2][0-9]:[0-5][0-9]" maxlength="5" title="24h-Format (z.B. 12:00)" oninput="this.value = this.value.replace(/[^0-9:]/g, ''); if(this.value.length === 2 && !this.value.includes(':')) this.value += ':';" style="text-align: center;">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Dringlichkeit:</label>
                            <select id="intern_dringlichkeit">
                                <option value="">-- Keine Dringlichkeit --</option>
                                <option value="dringend">ğŸ”´ Dringend</option>
                                <option value="heute">ğŸŸ  Heute</option>
                                <option value="woche">ğŸŸ¡ Laufe der Woche</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Mitarbeiter/Lehrling zuordnen (optional):</label>
                            <select id="intern_mitarbeiter">
                                <option value="">-- Niemand zugeordnet --</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Notizen:</label>
                            <textarea id="intern_notizen" rows="2" placeholder="ZusÃ¤tzliche Informationen..."></textarea>
                        </div>

                        <button type="submit" class="btn-sparkle btn-sparkle-info">
                            <svg class="sparkle-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 0L14.59 9.41L24 12L14.59 14.59L12 24L9.41 14.59L0 12L9.41 9.41L12 0Z"/>
                            </svg>
                            <span class="btn-text">Internen Termin erstellen</span>
                            <div class="dots-border"></div>
                        </button>
                    </form>
                </div>

                <!-- Bestehende interne Termine Liste (unter dem Formular) -->
                <div class="form-section" style="margin-top: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="margin: 0;">ğŸ“‹ Bestehende interne Termine</h3>
                        <button type="button" class="btn btn-secondary btn-sm" onclick="app.loadInterneTermineImSubTab()" title="Aktualisieren">ğŸ”„ Aktualisieren</button>
                    </div>
                    <div id="interneTermineSubTabListe" class="intern-termine-liste">
                        <div class="loading">Lade interne Termine...</div>
                    </div>
                    <div id="interneTermineSubTabKeine" class="intern-keine-auftraege" style="display: none;">
                        <span>ğŸ“­</span> Keine internen Termine vorhanden
                    </div>
                </div>
            </div>

            <!-- Wartende Aktionen Tab -->
            <div id="wartendeAktionen" class="sub-tab-content">
                <div class="wartende-aktionen-header">
                    <div class="wartende-info">
                        <h3>ğŸ• Wartende Aktionen</h3>
                        <p style="color: #666;">FÃ¼r RÃ¼ckrufaktionen, Teilebestellungen oder allgemein wartende AuftrÃ¤ge - damit nichts vergessen wird!</p>
                    </div>
                    <div class="wartende-stats">
                        <div class="stat-box">
                            <span class="stat-value" id="wartendeAnzahl">0</span>
                            <span class="stat-label">Wartend</span>
                        </div>
                    </div>
                </div>

                <!-- Neuen wartenden Termin erstellen -->
                <div class="form-section wartende-neu-section">
                    <h4>â• Neue wartende Aktion erstellen</h4>
                    <form id="wartendeAktionForm">
                        <!-- Kundensuche -->
                        <div class="kunde-suche-bereich">
                            <div class="form-group">
                                <label>ğŸ‘¤ Kundenname suchen:</label>
                                <div class="suche-input-wrapper">
                                    <input type="text" id="wartendNameSuche" placeholder="z.B. Mustermann, Max..." autocomplete="off">
                                    <span id="wartendKundeStatusAnzeige" class="kunde-status-badge" style="display: none;"></span>
                                    <div id="wartendNameVorschlaege" class="suche-vorschlaege"></div>
                                </div>
                            </div>
                            
                            <div class="suche-oder-trenner">
                                <span>oder</span>
                            </div>
                            
                            <div class="form-group">
                                <label>ğŸš— Kennzeichen suchen:</label>
                                <div class="kennzeichen-suche-felder">
                                    <input type="text" id="wartendKzBezirk" class="kz-feld kz-bezirk" placeholder="OSL" maxlength="3" autocomplete="off">
                                    <div class="kz-siegel"></div>
                                    <input type="text" id="wartendKzBuchstaben" class="kz-feld kz-buchstaben" placeholder="KI" maxlength="2" autocomplete="off">
                                    <input type="text" id="wartendKzNummer" class="kz-feld kz-nummer" placeholder="123" maxlength="4" autocomplete="off">
                                </div>
                                <div id="wartendKzVorschlaege" class="suche-vorschlaege kennzeichen-vorschlaege"></div>
                            </div>
                        </div>

                        <!-- Gefundener Kunde -->
                        <div id="wartendGefundenerKunde" class="kunde-gefunden-box" style="display: none; margin-bottom: 15px; padding: 12px 15px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%); border-radius: 8px; border-left: 4px solid #4caf50;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <span style="font-weight: 600; color: #2e7d32;">ğŸ‘¤ Kunde gefunden:</span>
                                    <span id="wartendKundeName" style="font-size: 1.1em; font-weight: bold; color: #1b5e20; margin-left: 8px;"></span>
                                </div>
                                <span id="wartendKundeTelefon" style="color: #666; font-size: 0.9em;"></span>
                            </div>
                        </div>

                        <input type="hidden" id="wartend_kunde_id">

                        <div class="form-row">
                            <div class="form-group">
                                <label>ğŸš— Kennzeichen: *</label>
                                <input type="text" id="wartend_kennzeichen" required placeholder="z.B. B-AB 1234">
                            </div>
                            <div class="form-group">
                                <label>ğŸš™ Fahrzeugtyp:</label>
                                <input type="text" id="wartend_fahrzeugtyp" placeholder="z.B. VW Golf 7, BMW 320d">
                            </div>
                        </div>

                        <div class="form-group wartend-grund-section">
                            <label>ğŸ“ Grund / Beschreibung: *</label>
                            
                            <!-- Schnellauswahl Buttons -->
                            <div class="wartend-schnellauswahl">
                                <span class="schnellauswahl-label">Schnellauswahl:</span>
                                <button type="button" class="schnellauswahl-btn" onclick="app.setWartendGrund('ğŸ”” RÃ¼ckrufaktion')">ğŸ”” RÃ¼ckrufaktion</button>
                                <button type="button" class="schnellauswahl-btn" onclick="app.setWartendGrund('ğŸ¯ Airbag-RÃ¼ckruf')">ğŸ¯ Airbag</button>
                                <button type="button" class="schnellauswahl-btn" onclick="app.setWartendGrund('ğŸ“¦ Teile bestellt')">ğŸ“¦ Teile bestellt</button>
                                <button type="button" class="schnellauswahl-btn" onclick="app.setWartendGrund('â³ Warte auf Teile')">â³ Warte auf Teile</button>
                                <button type="button" class="schnellauswahl-btn" onclick="app.setWartendGrund('ğŸ“ Kunde meldet sich')">ğŸ“ RÃ¼ckruf Kunde</button>
                                <button type="button" class="schnellauswahl-btn" onclick="app.setWartendGrund('ğŸ”§ Werkstatt-KapazitÃ¤t')">ğŸ”§ KapazitÃ¤t</button>
                            </div>
                            
                            <textarea id="wartend_beschreibung" rows="4" required placeholder="Beschreibung der wartenden Aktion...&#10;&#10;Beispiele:&#10;â€¢ Airbag-RÃ¼ckrufaktion - Teile bei VW bestellt&#10;â€¢ Turbolader defekt - Lieferung ca. 2 Wochen&#10;â€¢ Kunde meldet sich nach UrlaubsrÃ¼ckkehr"></textarea>
                            <small class="form-hint">ğŸ’¡ Tipp: Nutzen Sie die Schnellauswahl oder geben Sie eine eigene Beschreibung ein</small>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>â±ï¸ GeschÃ¤tzte Zeit (Stunden):</label>
                                <input type="number" id="wartend_zeit" min="0.25" step="0.25" placeholder="z.B. 2.5">
                            </div>
                            <div class="form-group">
                                <label>ğŸ¯ PrioritÃ¤t:</label>
                                <div class="prioritaet-auswahl">
                                    <label class="prioritaet-option prioritaet-hoch">
                                        <input type="radio" name="wartendPrioritaet" value="hoch">
                                        <span>ğŸ”´ Hoch</span>
                                    </label>
                                    <label class="prioritaet-option prioritaet-mittel">
                                        <input type="radio" name="wartendPrioritaet" value="mittel" checked>
                                        <span>ğŸŸ¡ Mittel</span>
                                    </label>
                                    <label class="prioritaet-option prioritaet-niedrig">
                                        <input type="radio" name="wartendPrioritaet" value="niedrig">
                                        <span>ğŸŸ¢ Niedrig</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>ğŸ“¦ Teile-Status:</label>
                                <select id="wartend_teile_status">
                                    <option value="">-- Nicht relevant --</option>
                                    <option value="bestellen">âš ï¸ Muss bestellt werden</option>
                                    <option value="bestellt">ğŸ“¦ Teile bestellt</option>
                                    <option value="eingetroffen">ğŸšš Teile eingetroffen</option>
                                    <option value="vorraetig">âœ… Teile vorrÃ¤tig</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>ğŸ“‹ Notizen:</label>
                            <input type="text" id="wartend_notizen" placeholder="z.B. Teilenummer, Lieferant, Lieferdatum...">
                        </div>

                        <button type="submit" class="btn-sparkle btn-sparkle-warning">
                            <svg class="sparkle-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 0L14.59 9.41L24 12L14.59 14.59L12 24L9.41 14.59L0 12L9.41 9.41L12 0Z"/>
                            </svg>
                            <span class="btn-text">ğŸ• Wartende Aktion erstellen</span>
                            <div class="dots-border"></div>
                        </button>
                    </form>
                </div>

                <!-- Liste der wartenden Aktionen -->
                <div class="form-section wartende-liste-section">
                    <h4>ğŸ“‹ Aktuelle wartende Aktionen</h4>
                    <div id="wartendeAktionenListe" class="wartende-liste">
                        <div class="loading">Lade wartende Aktionen...</div>
                    </div>
                </div>
            </div>
        </template>

        <!-- Kunden Tab -->
        <div id="kunden" class="tab-content" data-template-id="tab-template-kunden"></div>

        <template id="tab-template-kunden">
            <div class="page-header">
                <h2>ğŸ‘¥ Kundenverwaltung</h2>
                <p class="page-subtitle">Suchen und verwalten Sie Ihre Kunden und Fahrzeuge</p>
            </div>

            <div class="form-section" style="margin-bottom: 30px;">
                <div class="form-group">
                    <label>Kundenname oder Kennzeichen suchen:</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="kundenSearchInput" placeholder="Kundenname oder Kennzeichen suchen..." style="flex: 1; padding: 10px; font-size: 16px;">
                        <button id="kundenSearchBtn" class="btn btn-primary">Suchen</button>
                    </div>
                </div>
            </div>

            <div id="kundenSearchResults" style="display: none;">
                <h3>Suchergebnisse</h3>
                <div id="kundenResultsContainer"></div>
            </div>

            <div id="kundenSearchEmpty" style="display: none; text-align: center; padding: 40px; color: #666;">
                <p style="font-size: 18px;">Keine Kunden gefunden</p>
                <p>Versuchen Sie es mit einem anderen Suchbegriff.</p>
            </div>

            <div id="kundenSearchLoading" style="display: none; text-align: center; padding: 40px;">
                <p>Suche lÃ¤uft...</p>
            </div>
        </template>

        <!-- Ersatzautos Tab -->
        <div id="ersatzautos" class="tab-content" data-template-id="tab-template-ersatzautos"></div>

        <template id="tab-template-ersatzautos">
            <div class="page-header">
                <h2>ğŸš— Ersatzauto-Verwaltung</h2>
                <p class="page-subtitle">Verwalten Sie Ihre Ersatzfahrzeuge und deren VerfÃ¼gbarkeit</p>
            </div>

            <!-- Schnellzugriff: Fahrzeug-Kacheln -->
            <div class="form-section" style="margin-bottom: 20px;">
                <h3>âš¡ Schnellzugriff - VerfÃ¼gbarkeit umschalten</h3>
                <p style="color: #666; margin-bottom: 15px;">Klicken Sie auf ein Fahrzeug, um die VerfÃ¼gbarkeit manuell zu Ã¤ndern (z.B. wenn ein Kunde das Auto frÃ¼her zurÃ¼ckbringt)</p>
                <div id="ersatzautoKacheln" class="ersatzauto-kacheln" style="display: flex; gap: 20px; flex-wrap: wrap;">
                    <div class="loading">Lade Fahrzeuge...</div>
                </div>
            </div>

            <div class="dashboard-grid" style="grid-template-columns: repeat(4, 1fr); margin-bottom: 30px;">
                <div class="dashboard-card">
                    <div class="card-icon">ğŸ“ˆ</div>
                    <div class="card-content">
                        <h3>Gesamt</h3>
                        <div class="card-value" id="ersatzautoGesamt">0</div>
                        <div class="card-detail">Fahrzeuge registriert</div>
                    </div>
                </div>
                <div class="dashboard-card">
                    <div class="card-icon">ğŸ“ˆ</div>
                    <div class="card-content">
                        <h3>Heute VerfÃ¼gbar</h3>
                        <div class="card-value" id="ersatzautoHeuteVerfuegbar">0</div>
                        <div class="card-detail">Freie Fahrzeuge</div>
                    </div>
                </div>
                <div class="dashboard-card">
                    <div class="card-icon">ğŸ“ˆ</div>
                    <div class="card-content">
                        <h3>Heute Vergeben</h3>
                        <div class="card-value" id="ersatzautoHeuteVergeben">0</div>
                        <div class="card-detail">Im Einsatz</div>
                    </div>
                </div>
                <div class="dashboard-card" style="border-left: 4px solid #ef4444;">
                    <div class="card-icon">ğŸ“ˆ</div>
                    <div class="card-content">
                        <h3>Manuell Gesperrt</h3>
                        <div class="card-value" id="ersatzautoGesperrt" style="color: #ef4444;">0</div>
                        <div class="card-detail">Nicht verfÃ¼gbar</div>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>â• Neues Ersatzfahrzeug hinzufÃ¼gen</h3>
                <form id="ersatzautoForm" class="form-row" style="display: flex; gap: 15px; align-items: flex-end; flex-wrap: wrap;">
                    <div class="form-group" style="flex: 1; min-width: 150px;">
                        <label for="ersatzautoKennzeichen">Kennzeichen *</label>
                        <input type="text" id="ersatzautoKennzeichen" placeholder="z.B. K-AB 1234" required 
                               style="text-transform: uppercase;">
                    </div>
                    <div class="form-group" style="flex: 1.5; min-width: 180px;">
                        <label for="ersatzautoName">Fahrzeugname *</label>
                        <input type="text" id="ersatzautoName" placeholder="z.B. VW Golf" required>
                    </div>
                    <div class="form-group" style="flex: 1; min-width: 150px;">
                        <label for="ersatzautoTyp">Typ / Kategorie</label>
                        <select id="ersatzautoTyp">
                            <option value="">-- AuswÃ¤hlen --</option>
                            <option value="Kleinwagen">Kleinwagen</option>
                            <option value="Kompakt">Kompaktwagen</option>
                            <option value="Mittelklasse">Mittelklasse</option>
                            <option value="Kombi">Kombi</option>
                            <option value="SUV">SUV</option>
                            <option value="Transporter">Transporter</option>
                        </select>
                    </div>
                    <div class="form-group" style="flex: 0;">
                        <button type="submit" class="btn btn-primary" style="white-space: nowrap;">
                            â• HinzufÃ¼gen
                        </button>
                    </div>
                </form>
                <input type="hidden" id="ersatzautoEditId" value="">
            </div>

            <div class="form-section">
                <h3>ğŸ“‹ Registrierte Fahrzeuge</h3>
                <div id="ersatzautoListe" class="ersatzauto-liste">
                    <div class="loading">Lade Fahrzeuge...</div>
                </div>
            </div>

            <!-- Aktuelle Buchungen -->
            <div class="form-section">
                <h3>ğŸ”‘ Aktuell vergebene Fahrzeuge</h3>
                <p style="color: #666; margin-bottom: 15px;">Zeigt alle Ersatzautos, die heute vergeben sind oder deren Buchung noch lÃ¤uft</p>
                <div id="ersatzautoBuchungen" class="ersatzauto-buchungen">
                    <div class="loading">Lade Buchungen...</div>
                </div>
            </div>

            <div class="form-section">
                <h3>ğŸ“… VerfÃ¼gbarkeits-Ãœbersicht</h3>
                <p style="color: #666; margin-bottom: 15px;">Zeigt die Ausleihen der Ersatzautos fÃ¼r die nÃ¤chsten Wochen</p>
                
                <div class="ersatzauto-legende" style="display: flex; gap: 20px; margin-bottom: 15px; padding: 10px; background: #f8fafc; border-radius: 8px;">
                    <div style="display: flex; align-items: center; gap: 6px;">
                        <span class="ea-status-dot ea-frei"></span>
                        <span>Alle frei</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 6px;">
                        <span class="ea-status-dot ea-teilweise"></span>
                        <span>Teilweise vergeben</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 6px;">
                        <span class="ea-status-dot ea-voll"></span>
                        <span>Alle vergeben</span>
                    </div>
                </div>
                
                <div id="ersatzautoUebersicht">
                    <div class="loading">Lade Ãœbersicht...</div>
                </div>
            </div>
        </template>

        <div id="zeitverwaltung" class="tab-content" data-template-id="tab-template-zeitverwaltung"></div>

        <template id="tab-template-zeitverwaltung">
            <div class="page-header">
                <h2>â±ï¸ Zeitverwaltung</h2>
                <p class="page-subtitle">Termine verwalten, Zeiten erfassen und Mitarbeiter organisieren</p>
            </div>

            <div class="sub-tabs modern-tabs">
                <button class="sub-tab-button active" data-subtab="alleTermineVerwalten">
                    <span class="tab-icon">ğŸ“</span>
                    <span class="tab-label">Termine verwalten</span>
                </button>
                <button class="sub-tab-button" data-subtab="teileStatus">
                    <span class="tab-icon">ğŸ“¦</span>
                    <span class="tab-label">Teile-Status</span>
                </button>
                <button class="sub-tab-button" data-subtab="standardzeiten">
                    <span class="tab-icon">â°</span>
                    <span class="tab-label">Standardzeiten</span>
                </button>
                <button class="sub-tab-button" data-subtab="mitarbeiter">
                    <span class="tab-icon">ğŸ‘·</span>
                    <span class="tab-label">Mitarbeiter</span>
                </button>
            </div>

            <div id="alleTermineVerwalten" class="sub-tab-content active">
                <!-- Info-Legende -->
                <div class="info-legend">
                    <div class="legend-item">
                        <span class="status-dot red"></span>
                        <span>Keine Zeit erfasst</span>
                    </div>
                    <div class="legend-item">
                        <span class="status-dot green"></span>
                        <span>Zeit erfasst</span>
                    </div>
                    <div class="legend-tip">
                        <span class="tip-icon">ğŸ’¡</span>
                        <span>Klicken Sie auf eine Zeile, um Zeiten fÃ¼r einzelne Arbeiten zu bearbeiten</span>
                    </div>
                </div>

                <!-- Navigation Panel -->
                <div class="zeit-nav-panel">
                    <div class="nav-section nav-date-controls">
                        <div class="nav-group">
                            <button id="prevWeekBtn" class="nav-btn" title="Vorherige Woche">
                                <span class="nav-icon">âª</span>
                                <span class="nav-text">Woche</span>
                            </button>
                            <button id="prevDayBtn" class="nav-btn" title="Vorheriger Tag">
                                <span class="nav-icon">â—€</span>
                                <span class="nav-text">Tag</span>
                            </button>
                        </div>
                        
                        <div class="date-picker-wrapper">
                            <input type="date" id="filterDatum" class="modern-date-input">
                        </div>
                        
                        <div class="nav-group">
                            <button id="nextDayBtn" class="nav-btn" title="NÃ¤chster Tag">
                                <span class="nav-text">Tag</span>
                                <span class="nav-icon">â–¶</span>
                            </button>
                            <button id="nextWeekBtn" class="nav-btn" title="NÃ¤chste Woche">
                                <span class="nav-text">Woche</span>
                                <span class="nav-icon">â©</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="nav-section nav-actions">
                        <button id="todayBtn" class="action-btn primary" title="Zum heutigen Tag">
                            <span class="btn-icon">ğŸ“…</span>
                            <span>Heute</span>
                        </button>
                        <button id="morgenBtn" class="action-btn primary-light" title="Morgen (Soâ†’Mo)">
                            <span class="btn-icon">ğŸ“†</span>
                            <span>Morgen</span>
                        </button>
                        <button id="wocheBtn" class="action-btn info" title="Diese Woche (Mo-Sa)">
                            <span class="btn-icon">ğŸ—“ï¸</span>
                            <span>Woche</span>
                        </button>
                        <button id="alleTermineBtn" class="action-btn secondary" title="Alle Termine anzeigen">
                            <span class="btn-icon">ğŸ“‹</span>
                            <span>Alle</span>
                        </button>
                        <button id="offeneTermineBtn" class="action-btn warning" title="Termine ohne erfasste Zeit">
                            <span class="btn-icon">ğŸ”´</span>
                            <span>Offene</span>
                        </button>
                        <button id="schwebendeTermineBtn" class="action-btn schwebend" title="Schwebende Termine anzeigen">
                            <span class="btn-icon">â³</span>
                            <span>Schwebend</span>
                        </button>
                    </div>
                </div>

                <!-- Datum-Anzeige -->
                <div class="current-date-display" id="zeitverwaltungDatumAnzeige">
                    <span class="date-icon">ğŸ—“ï¸</span>
                    <span class="date-text" id="zeitverwaltungDatumText">Alle Termine</span>
                </div>

                <!-- Tabelle -->
                <div class="table-container">
                    <table id="termineTable" class="modern-table">
                        <thead>
                            <tr>
                                <th style="width: 50px;">Status</th>
                                <th>Termin-Nr</th>
                                <th style="width: 90px;">Datum</th>
                                <th>Kunde</th>
                                <th>Kennzeichen</th>
                                <th style="width: 60px;">KM</th>
                                <th style="width: 40px;">EA</th>
                                <th>Arbeit</th>
                                <th style="width: 70px;">Zeit</th>
                                <th style="width: 70px;">MA</th>
                                <th style="width: 90px;">Status</th>
                                <th style="width: 120px;">Aktionen</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- NEUER TAB: Teile-Status -->
            <div id="teileStatus" class="sub-tab-content">
                <div class="page-header" style="margin-bottom: 20px;">
                    <h3>ğŸ“¦ Teile-Status Ãœbersicht</h3>
                    <p class="page-subtitle">Alle Termine mit Teile-Status auf einen Blick â€“ Klicken Sie auf eine Karte zum Filtern</p>
                </div>

                <!-- Statistik-Karten (klickbar zum Filtern) -->
                <div class="teile-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 25px;">
                    <div class="teile-stat-card teile-filter-card" data-filter="bestellen" onclick="app.filterTeileStatus('bestellen')" style="background: #ffebee; padding: 15px; border-radius: 8px; text-align: center; border-left: 4px solid #f44336; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;">
                        <div style="font-size: 24px; font-weight: bold; color: #c62828;" id="teileBestellenCount">0</div>
                        <div style="font-size: 12px; color: #666;">âš ï¸ Muss bestellt werden</div>
                    </div>
                    <div class="teile-stat-card teile-filter-card" data-filter="bestellt" onclick="app.filterTeileStatus('bestellt')" style="background: #fff3e0; padding: 15px; border-radius: 8px; text-align: center; border-left: 4px solid #ff9800; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;">
                        <div style="font-size: 24px; font-weight: bold; color: #e65100;" id="teileBestelltCount">0</div>
                        <div style="font-size: 12px; color: #666;">ğŸ“¦ Bestellt (wartend)</div>
                    </div>
                    <div class="teile-stat-card teile-filter-card" data-filter="eingetroffen" onclick="app.filterTeileStatus('eingetroffen')" style="background: #e8f5e9; padding: 15px; border-radius: 8px; text-align: center; border-left: 4px solid #4caf50; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;">
                        <div style="font-size: 24px; font-weight: bold; color: #2e7d32;" id="teileEingetroffenCount">0</div>
                        <div style="font-size: 12px; color: #666;">ğŸšš Eingetroffen</div>
                    </div>
                    <div class="teile-stat-card teile-filter-card" data-filter="vorraetig" onclick="app.filterTeileStatus('vorraetig')" style="background: #e3f2fd; padding: 15px; border-radius: 8px; text-align: center; border-left: 4px solid #2196f3; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;">
                        <div style="font-size: 24px; font-weight: bold; color: #1565c0;" id="teileVorraetigCount">0</div>
                        <div style="font-size: 12px; color: #666;">âœ… VorrÃ¤tig</div>
                    </div>
                </div>
                
                <!-- Aktiver Filter Anzeige -->
                <div id="teileAktiverFilter" style="display: none; margin-bottom: 15px; padding: 10px 15px; background: #f5f5f5; border-radius: 8px; justify-content: space-between; align-items: center;">
                    <span id="teileFilterLabel">Filter: Alle anzeigen</span>
                    <button class="btn btn-small" onclick="app.filterTeileStatus('alle')">âœ• Filter zurÃ¼cksetzen</button>
                </div>

                <!-- Teile-Status Tabelle -->
                <div class="table-container">
                    <table id="teileStatusTable" class="modern-table">
                        <thead>
                            <tr>
                                <th style="width: 100px;">Datum</th>
                                <th>Kunde</th>
                                <th>Kennzeichen</th>
                                <th>Arbeit</th>
                                <th style="width: 180px;">Teile-Status</th>
                                <th style="width: 120px;">Aktionen</th>
                            </tr>
                        </thead>
                        <tbody id="teileStatusTableBody">
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 30px; color: #666;">
                                    <span style="font-size: 24px;">ğŸ“¦</span><br>
                                    Lade Teile-Status...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="standardzeiten" class="sub-tab-content">
                <p>Hier kÃ¶nnen Sie die Standardzeiten fÃ¼r verschiedene Arbeiten anpassen.</p>

                <div class="table-section">
                    <div style="margin-bottom: 15px; display: flex; gap: 10px; align-items: center;">
                        <button class="btn btn-primary" onclick="app.addArbeitszeit()">â• Neue Standardzeit hinzufÃ¼gen</button>
                        <button class="btn btn-secondary" onclick="app.saveAllArbeitszeiten()">ğŸ’¾ Alle Speichern</button>
                    </div>
                    <table id="arbeitszeitenTable">
                        <thead>
                            <tr>
                                <th>Arbeit</th>
                                <th>Suchbegriffe / Aliase</th>
                                <th>Standardzeit (Stunden)</th>
                                <th>Aktionen</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <div style="margin-top: 10px; padding: 10px; background: #f0f7ff; border-left: 4px solid #4a90e2; border-radius: 4px;">
                        <strong>Hinweis:</strong> Eingabe in Stunden (z.B. 0.25 = 15 Min, 0.5 = 30 Min, 1 = 60 Min, 2 = 120 Min)<br>
                        <strong>Suchbegriffe:</strong> Mehrere durch Komma getrennt (z.B. "Wartung, Service, DS, Durchsicht") - alle finden dieselbe Standardzeit
                    </div>
                </div>
            </div>

            <div id="mitarbeiter" class="sub-tab-content">
                <div class="form-section">
                    <h3>âš™ï¸ Werkstatt-Einstellungen</h3>
                    <form id="werkstattSettingsForm" class="form-row">
                        <div class="form-group">
                            <label>Servicezeit pro Termin (Minuten):</label>
                            <input type="number" id="servicezeit_minuten" min="0" max="60" value="10" required>
                            <small style="display: block; color: #666; margin-top: 5px;">Zeit fÃ¼r Annahme und Rechnungschreiben pro Termin</small>
                        </div>
                        <div class="form-group">
                            <label>Nebenzeit (%):</label>
                            <input type="number" id="nebenzeit_prozent" min="0" max="100" step="0.1" value="0" required>
                            <small style="display: block; color: #666; margin-top: 5px;">Aufschlag auf zugeordnete Arbeit (Holen, Waschen etc.)</small>
                        </div>
                        <div class="form-group">
                            <label>Mittagspause (Minuten):</label>
                            <input type="number" id="mittagspause_minuten" min="0" max="120" value="30" required>
                            <small style="display: block; color: #666; margin-top: 5px;">Dauer der Mittagspause (gilt fÃ¼r alle)</small>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <button type="submit" class="btn btn-primary">Speichern</button>
                        </div>
                    </form>
                    <p class="hint">Die Anzahl der Mitarbeiter wird automatisch aus den aktiven Mitarbeitern berechnet. Arbeitsstunden werden pro Mitarbeiter individuell eingestellt. Die Servicezeit wird pro Termin von der verfÃ¼gbaren Zeit abgezogen.</p>
                </div>

                <div class="form-section">
                    <h3>Mitarbeiter</h3>
                    <div style="margin-bottom: 15px;">
                        <button class="btn btn-primary" onclick="app.addMitarbeiter()">â• Neuer Mitarbeiter</button>
                    </div>
                    <table id="mitarbeiterTable" style="font-size: 0.9em;">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Mittagspause</th>
                                <th>Nur Service</th>
                                <th>Aktiv</th>
                                <th>Aktionen</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <p class="hint" style="margin-top: 10px;">
                        <strong>Hinweis:</strong> Arbeitszeiten werden jetzt unter "ğŸ“… Flexible Arbeitszeiten" konfiguriert.
                    </p>
                </div>

                <div class="form-section">
                    <h3>Lehrlinge</h3>
                    <div style="margin-bottom: 15px;">
                        <button class="btn btn-primary" onclick="app.addLehrling()">â• Neuer Lehrling</button>
                    </div>
                    <table id="lehrlingeTable" style="font-size: 0.9em;">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th title="Prozentuale AufgabenbewÃ¤ltigung">Aufgabe (%)</th>
                                <th>Mittagspause</th>
                                <th>ğŸ“š Berufsschul-KW</th>
                                <th>Aktiv</th>
                                <th>Aktionen</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <p class="hint" style="margin-top: 10px;">
                        Arbeitszeiten werden jetzt unter "ğŸ“… Flexible Arbeitszeiten" konfiguriert.<br>
                        AufgabenbewÃ¤ltigung: 100% = Standardzeit, 200% = doppelte Zeit<br>
                        ğŸ“š Berufsschul-KW: Klicken Sie auf die KW-Spalte oder gehen Sie zu "Abwesenheiten â†’ Berufsschule"
                    </p>
                </div>

                <div class="form-section">
                    <h3>ğŸ“… Flexible Arbeitszeiten</h3>
                    <p class="hint" style="margin-bottom: 15px;">
                        Hier kÃ¶nnen Sie individuelle Arbeitszeiten pro Wochentag oder fÃ¼r spezifische ZeitrÃ¤ume festlegen.<br>
                        <strong>PrioritÃ¤t:</strong> Spezifisches Datum > Wochentag-Muster > Standard-Wochenarbeitszeit
                    </p>

                    <!-- Person auswÃ¤hlen -->
                    <div class="form-row" style="margin-bottom: 20px;">
                        <div class="form-group">
                            <label for="arbeitszeitenPersonSelect">Person auswÃ¤hlen:</label>
                            <select id="arbeitszeitenPersonSelect" class="form-control" onchange="app.loadArbeitszeitenForPerson()">
                                <option value="">-- Person wÃ¤hlen --</option>
                            </select>
                        </div>
                    </div>

                    <!-- Wochenmuster Gitter -->
                    <div id="arbeitszeitenWochenGrid" style="display: none;">
                        <h4>ğŸ—“ï¸ Wochentag-Muster</h4>
                        <p class="hint" style="margin-bottom: 10px; font-size: 0.9em;">
                            Standard-Arbeitszeiten pro Wochentag. Diese gelten, wenn kein spezifisches Datum definiert ist.
                        </p>
                        
                        <!-- Schicht-Schnellauswahl -->
                        <div style="margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                            <label style="font-weight: 600; margin-bottom: 8px; display: block;">âš¡ Schicht-Schnellauswahl:</label>
                            <div id="schichtTemplateButtons" style="display: flex; gap: 8px; flex-wrap: wrap;">
                                <button class="btn btn-secondary btn-sm" onclick="app.loadSchichtTemplates()">Lade Schichten...</button>
                            </div>
                            <p class="hint" style="margin-top: 8px; margin-bottom: 0; font-size: 0.85em;">
                                WÃ¤hlen Sie eine Schicht-Vorlage, um alle Zeiten fÃ¼r Mo-Fr automatisch zu setzen.
                            </p>
                        </div>
                        
                        <div class="arbeitszeiten-grid">
                            <div class="arbeitszeiten-grid-row arbeitszeiten-grid-header">
                                <div>Wochentag</div>
                                <div>Beginn</div>
                                <div>Ende</div>
                                <div>Stunden</div>
                                <div>Frei</div>
                            </div>
                            <div class="arbeitszeiten-grid-row" data-wochentag="1">
                                <div class="wochentag-label">Montag</div>
                                <div><input type="time" class="form-control" id="wochentag_1_start" value="08:00" onchange="app.updateWochentagEndzeit(1)"></div>
                                <div><input type="time" class="form-control" id="wochentag_1_ende" value="16:30" onchange="app.updateWochentagStunden(1)"></div>
                                <div><input type="number" class="form-control" id="wochentag_1_stunden" min="0" max="24" step="0.25" value="8" readonly style="background: #f8f9fa;"></div>
                                <div><input type="checkbox" id="wochentag_1_frei" onchange="app.updateWochentagStundenStatus(1)"></div>
                            </div>
                            <div class="arbeitszeiten-grid-row" data-wochentag="2">
                                <div class="wochentag-label">Dienstag</div>
                                <div><input type="time" class="form-control" id="wochentag_2_start" value="08:00" onchange="app.updateWochentagEndzeit(2)"></div>
                                <div><input type="time" class="form-control" id="wochentag_2_ende" value="16:30" onchange="app.updateWochentagStunden(2)"></div>
                                <div><input type="number" class="form-control" id="wochentag_2_stunden" min="0" max="24" step="0.25" value="8" readonly style="background: #f8f9fa;"></div>
                                <div><input type="checkbox" id="wochentag_2_frei" onchange="app.updateWochentagStundenStatus(2)"></div>
                            </div>
                            <div class="arbeitszeiten-grid-row" data-wochentag="3">
                                <div class="wochentag-label">Mittwoch</div>
                                <div><input type="time" class="form-control" id="wochentag_3_start" value="08:00" onchange="app.updateWochentagEndzeit(3)"></div>
                                <div><input type="time" class="form-control" id="wochentag_3_ende" value="16:30" onchange="app.updateWochentagStunden(3)"></div>
                                <div><input type="number" class="form-control" id="wochentag_3_stunden" min="0" max="24" step="0.25" value="8" readonly style="background: #f8f9fa;"></div>
                                <div><input type="checkbox" id="wochentag_3_frei" onchange="app.updateWochentagStundenStatus(3)"></div>
                            </div>
                            <div class="arbeitszeiten-grid-row" data-wochentag="4">
                                <div class="wochentag-label">Donnerstag</div>
                                <div><input type="time" class="form-control" id="wochentag_4_start" value="08:00" onchange="app.updateWochentagEndzeit(4)"></div>
                                <div><input type="time" class="form-control" id="wochentag_4_ende" value="16:30" onchange="app.updateWochentagStunden(4)"></div>
                                <div><input type="number" class="form-control" id="wochentag_4_stunden" min="0" max="24" step="0.25" value="8" readonly style="background: #f8f9fa;"></div>
                                <div><input type="checkbox" id="wochentag_4_frei" onchange="app.updateWochentagStundenStatus(4)"></div>
                            </div>
                            <div class="arbeitszeiten-grid-row" data-wochentag="5">
                                <div class="wochentag-label">Freitag</div>
                                <div><input type="time" class="form-control" id="wochentag_5_start" value="08:00" onchange="app.updateWochentagEndzeit(5)"></div>
                                <div><input type="time" class="form-control" id="wochentag_5_ende" value="16:30" onchange="app.updateWochentagStunden(5)"></div>
                                <div><input type="number" class="form-control" id="wochentag_5_stunden" min="0" max="24" step="0.25" value="8" readonly style="background: #f8f9fa;"></div>
                                <div><input type="checkbox" id="wochentag_5_frei" onchange="app.updateWochentagStundenStatus(5)"></div>
                            </div>
                            <div class="arbeitszeiten-grid-row" data-wochentag="6">
                                <div class="wochentag-label">Samstag</div>
                                <div><input type="time" class="form-control" id="wochentag_6_start" value="08:00" onchange="app.updateWochentagEndzeit(6)"></div>
                                <div><input type="time" class="form-control" id="wochentag_6_ende" value="08:00" onchange="app.updateWochentagStunden(6)"></div>
                                <div><input type="number" class="form-control" id="wochentag_6_stunden" min="0" max="24" step="0.25" value="0" readonly style="background: #f8f9fa;"></div>
                                <div><input type="checkbox" id="wochentag_6_frei" checked onchange="app.updateWochentagStundenStatus(6)"></div>
                            </div>
                            <div class="arbeitszeiten-grid-row" data-wochentag="7">
                                <div class="wochentag-label">Sonntag</div>
                                <div><input type="time" class="form-control" id="wochentag_7_start" value="08:00" onchange="app.updateWochentagEndzeit(7)"></div>
                                <div><input type="time" class="form-control" id="wochentag_7_ende" value="08:00" onchange="app.updateWochentagStunden(7)"></div>
                                <div><input type="number" class="form-control" id="wochentag_7_stunden" min="0" max="24" step="0.25" value="0" readonly style="background: #f8f9fa;"></div>
                                <div><input type="checkbox" id="wochentag_7_frei" checked onchange="app.updateWochentagStundenStatus(7)"></div>
                            </div>
                        </div>
                        <div style="margin-top: 15px;">
                            <button class="btn btn-primary" onclick="app.saveWochenMuster()">ğŸ’¾ Wochenmuster speichern</button>
                            <button class="btn btn-secondary" onclick="app.resetArbeitszeitenToStandard()" title="Setzt Wochenmuster auf Standard-Wochenarbeitszeit zurÃ¼ck">ğŸ”„ Auf Standard zurÃ¼cksetzen</button>
                        </div>
                    </div>

                    <!-- Spezifische ZeitrÃ¤ume -->
                    <div id="arbeitszeitenDateForm" style="display: none; margin-top: 30px;">
                        <h4>ğŸ“† Spezifischer Zeitraum</h4>
                        <p class="hint" style="margin-bottom: 10px; font-size: 0.9em;">
                            Definieren Sie abweichende Arbeitszeiten fÃ¼r einen bestimmten Zeitraum (z.B. reduzierte Stunden, freie Tage).<br>
                            <strong>Hinweis:</strong> Nur zukÃ¼nftige Daten kÃ¶nnen bearbeitet werden.
                        </p>
                        <form id="arbeitszeitenDateRangeForm" onsubmit="app.saveArbeitszeitenDateRange(event)">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="arbeitszeitenDatumVon">Von Datum:</label>
                                    <input type="date" id="arbeitszeitenDatumVon" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="arbeitszeitenDatumBis">Bis Datum:</label>
                                    <input type="date" id="arbeitszeitenDatumBis" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="arbeitszeitenDateStunden">Arbeitsstunden/Tag:</label>
                                    <input type="number" id="arbeitszeitenDateStunden" class="form-control" min="0" max="24" step="0.25" value="8">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="arbeitszeitenDateFrei">
                                        <input type="checkbox" id="arbeitszeitenDateFrei" onchange="app.toggleDateRangeFreiStatus()">
                                        Freie Tage (keine Arbeitszeit)
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label for="arbeitszeitenDateBeschreibung">Beschreibung (optional):</label>
                                    <input type="text" id="arbeitszeitenDateBeschreibung" class="form-control" placeholder="z.B. Kurzarbeit, Teilzeit">
                                </div>
                            </div>
                            <div style="margin-top: 10px;">
                                <button type="submit" class="btn btn-primary">â• Zeitraum hinzufÃ¼gen</button>
                            </div>
                        </form>

                        <!-- Liste bestehender ZeitrÃ¤ume -->
                        <div id="arbeitszeitenDateList" style="margin-top: 20px;">
                            <h5>Definierte ZeitrÃ¤ume</h5>
                            <table id="arbeitszeitenDateTable" style="font-size: 0.9em; width: 100%;">
                                <thead>
                                    <tr>
                                        <th>Von</th>
                                        <th>Bis</th>
                                        <th>Stunden/Tag</th>
                                        <th>Status</th>
                                        <th>Beschreibung</th>
                                        <th>Aktionen</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Abwesenheiten</h3>

                    <div class="sub-tabs">
                        <button class="sub-tab-button active" data-subtab="urlaubAbwesenheit">ğŸ–ï¸ Urlaub</button>
                        <button class="sub-tab-button" data-subtab="krankAbwesenheit">ğŸ¤’ Krank</button>
                        <button class="sub-tab-button" data-subtab="lehrgangAbwesenheit">ğŸ“– Lehrgang</button>
                        <button class="sub-tab-button" data-subtab="berufsschuleAbwesenheit">ğŸ“š Berufsschule</button>
                    </div>

                    <div id="urlaubAbwesenheit" class="sub-tab-content active">
                        <h4>Urlaub eintragen</h4>
                        <form id="urlaubForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Mitarbeiter/Lehrling: *</label>
                                    <select id="urlaubPerson" required>
                                        <option value="">-- Bitte wÃ¤hlen --</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Von Datum: *</label>
                                    <input type="date" id="urlaubVonDatum" required>
                                </div>
                                <div class="form-group">
                                    <label>Bis Datum: *</label>
                                    <input type="date" id="urlaubBisDatum" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Beschreibung (optional):</label>
                                <textarea id="urlaubBeschreibung" rows="2" placeholder="z.B. Sommerurlaub, Familienfeier"></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">Urlaub eintragen</button>
                        </form>

                        <div id="urlaubListe" style="margin-top: 30px;">
                            <h4>Eingetragene Urlaube</h4>
                            <table id="urlaubTable">
                                <thead>
                                    <tr>
                                        <th>Person</th>
                                        <th>Von</th>
                                        <th>Bis</th>
                                        <th>Beschreibung</th>
                                        <th>Aktionen</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>

                    <div id="krankAbwesenheit" class="sub-tab-content">
                        <h4>Krankmeldung eintragen</h4>
                        <form id="krankForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Mitarbeiter/Lehrling: *</label>
                                    <select id="krankPerson" required>
                                        <option value="">-- Bitte wÃ¤hlen --</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Von Datum: *</label>
                                    <input type="date" id="krankVonDatum" required>
                                </div>
                                <div class="form-group">
                                    <label>Bis Datum: *</label>
                                    <input type="date" id="krankBisDatum" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Beschreibung (optional):</label>
                                <textarea id="krankBeschreibung" rows="2" placeholder="z.B. Grippe, Arzttermin"></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">Krankmeldung eintragen</button>
                        </form>

                        <div id="krankListe" style="margin-top: 30px;">
                            <h4>Eingetragene Krankmeldungen</h4>
                            <table id="krankTable">
                                <thead>
                                    <tr>
                                        <th>Person</th>
                                        <th>Von</th>
                                        <th>Bis</th>
                                        <th>Beschreibung</th>
                                        <th>Aktionen</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>

                    <div id="lehrgangAbwesenheit" class="sub-tab-content">
                        <h4>Lehrgang/Fortbildung eintragen</h4>
                        <form id="lehrgangForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Mitarbeiter/Lehrling: *</label>
                                    <select id="lehrgangPerson" required>
                                        <option value="">-- Bitte wÃ¤hlen --</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Von Datum: *</label>
                                    <input type="date" id="lehrgangVonDatum" required>
                                </div>
                                <div class="form-group">
                                    <label>Bis Datum: *</label>
                                    <input type="date" id="lehrgangBisDatum" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Beschreibung (optional):</label>
                                <textarea id="lehrgangBeschreibung" rows="2" placeholder="z.B. SchweiÃŸlehrgang, Diagnoseschulung"></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">Lehrgang eintragen</button>
                        </form>

                        <div id="lehrgangListe" style="margin-top: 30px;">
                            <h4>Eingetragene LehrgÃ¤nge</h4>
                            <table id="lehrgangTable">
                                <thead>
                                    <tr>
                                        <th>Person</th>
                                        <th>Von</th>
                                        <th>Bis</th>
                                        <th>Beschreibung</th>
                                        <th>Aktionen</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>

                    <div id="berufsschuleAbwesenheit" class="sub-tab-content">
                        <h4>ğŸ“š Berufsschul-Kalenderwochen verwalten</h4>
                        <p style="color: #666; margin-bottom: 20px;">Trage hier die Kalenderwochen ein, in denen die Lehrlinge Berufsschule haben (z.B. 2,6,10,14).</p>
                        
                        <table id="berufsschuleTable">
                            <thead>
                                <tr>
                                    <th>Lehrling</th>
                                    <th>Berufsschul-Kalenderwochen</th>
                                    <th>Aktionen</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </template>

        <div id="auslastung" class="tab-content" data-template-id="tab-template-auslastung"></div>

        <template id="tab-template-auslastung">
            <div class="page-header">
                <h2>ğŸ“ˆ Auslastungsanzeige</h2>
                <p class="page-subtitle">Tages- und WochenÃ¼bersicht der Werkstattauslastung</p>
            </div>

            <div class="auslastung-navigation">
                <div class="nav-row">
                    <button type="button" id="auslastungPrevTag" class="btn btn-nav" title="Vorheriger Tag">â—€ Tag</button>
                    <div class="form-group" style="margin: 0;">
                        <input type="date" id="auslastungDatum">
                    </div>
                    <button type="button" id="auslastungNextTag" class="btn btn-nav" title="NÃ¤chster Tag">Tag â–¶</button>
                    <button type="button" id="auslastungHeuteBtn" class="btn btn-today" title="Heute">Heute</button>
                </div>
                <div class="nav-row">
                    <button type="button" id="auslastungPrevWoche" class="btn btn-nav-week" title="Vorherige Woche">â—€â—€ Woche</button>
                    <span id="auslastungWocheInfo" class="woche-info"></span>
                    <span id="auslastungAktuellerTag" class="aktueller-tag-badge"></span>
                    <button type="button" id="auslastungNextWoche" class="btn btn-nav-week" title="NÃ¤chste Woche">Woche â–¶â–¶</button>
                </div>
            </div>

            <!-- NEUE ZEITLEISTEN-ANSICHT -->
            <div class="form-section zeitleiste-section">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                    <div>
                        <h3 style="margin: 0;">ğŸ“… Tages-Zeitleiste (8:00 - 18:00 Uhr)</h3>
                        <p style="color: #666; margin: 5px 0 0 0;">Ãœbersicht aller Arbeiten mit geplanter Start- und Endzeit</p>
                    </div>
                    <button type="button" class="btn btn-warning" onclick="app.pruefeUeberschneidungen()" title="PrÃ¼ft alle Termine auf Ãœberschneidungen und schlÃ¤gt Verschiebungen vor">
                        ğŸ” Ãœberschneidungen prÃ¼fen
                    </button>
                </div>
                
                <div class="zeitleiste-container">
                    <!-- Stunden-Header -->
                    <div class="zeitleiste-header">
                        <div class="zeitleiste-label-col">Mitarbeiter</div>
                        <div class="zeitleiste-stunden">
                            <div class="stunde-marker-group">
                                <span class="stunde-marker">8</span>
                                <span class="halbe-stunde">:30</span>
                            </div>
                            <div class="stunde-marker-group">
                                <span class="stunde-marker">9</span>
                                <span class="halbe-stunde">:30</span>
                            </div>
                            <div class="stunde-marker-group">
                                <span class="stunde-marker">10</span>
                                <span class="halbe-stunde">:30</span>
                            </div>
                            <div class="stunde-marker-group">
                                <span class="stunde-marker">11</span>
                                <span class="halbe-stunde">:30</span>
                            </div>
                            <div class="stunde-marker-group">
                                <span class="stunde-marker">12</span>
                                <span class="halbe-stunde">:30</span>
                            </div>
                            <div class="stunde-marker-group">
                                <span class="stunde-marker">13</span>
                                <span class="halbe-stunde">:30</span>
                            </div>
                            <div class="stunde-marker-group">
                                <span class="stunde-marker">14</span>
                                <span class="halbe-stunde">:30</span>
                            </div>
                            <div class="stunde-marker-group">
                                <span class="stunde-marker">15</span>
                                <span class="halbe-stunde">:30</span>
                            </div>
                            <div class="stunde-marker-group">
                                <span class="stunde-marker">16</span>
                                <span class="halbe-stunde">:30</span>
                            </div>
                            <div class="stunde-marker-group">
                                <span class="stunde-marker">17</span>
                                <span class="halbe-stunde">:30</span>
                            </div>
                            <div class="stunde-marker-group stunde-marker-last">
                                <span class="stunde-marker">18</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Zeitleisten-Body (wird per JavaScript gefÃ¼llt) -->
                    <div class="zeitleiste-body" id="zeitleisteBody">
                        <div class="zeitleiste-loading">
                            <span>â³</span> Lade Zeitleiste...
                        </div>
                    </div>
                </div>
                
                <!-- Legende fÃ¼r Zeitleiste -->
                <div class="zeitleiste-legende">
                    <div class="legende-item">
                        <span class="color-box status-geplant"></span>
                        <span>Geplant</span>
                    </div>
                    <div class="legende-item">
                        <span class="color-box status-in-arbeit"></span>
                        <span>In Arbeit</span>
                    </div>
                    <div class="legende-item">
                        <span class="color-box status-abgeschlossen"></span>
                        <span>Abgeschlossen</span>
                    </div>
                    <div class="legende-item">
                        <span class="color-box" style="background: #9e9e9e;"></span>
                        <span>Ohne Startzeit</span>
                    </div>
                    <div class="legende-item">
                        <span class="color-box" style="background: repeating-linear-gradient(-45deg, rgba(239, 83, 80, 0.15), rgba(239, 83, 80, 0.15) 4px, rgba(239, 83, 80, 0.25) 4px, rgba(239, 83, 80, 0.25) 8px); border: 2px dashed #ef5350; border-radius: 4px;"></span>
                        <span>ğŸ½ï¸ Mittagspause</span>
                    </div>
                </div>
            </div>

            <div class="auslastung-display">
                <div class="auslastung-info">
                    <div class="info-item">
                        <span class="label">Geplant:</span>
                        <span id="geplant" class="value">0 h</span>
                    </div>
                    <div class="info-item">
                        <span class="label">In Arbeit:</span>
                        <span id="inArbeit" class="value">0 h</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Abgeschlossen:</span>
                        <span id="abgeschlossen" class="value">0 h</span>
                    </div>
                    <div class="info-item">
                        <span class="label">VerfÃ¼gbar:</span>
                        <span id="verfuegbar" class="value">8.0 h</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Auslastung:</span>
                        <span id="prozent" class="value">0%</span>
                    </div>
                </div>

                <div class="progress-bar">
                    <div id="progressGeplant" class="progress-segment progress-geplant" style="width: 0%;"></div>
                    <div id="progressInArbeit" class="progress-segment progress-in-arbeit" style="width: 0%;"></div>
                    <div id="progressAbgeschlossen" class="progress-segment progress-abgeschlossen" style="width: 0%;"></div>
                    <div id="progressEmpty" class="progress-empty" style="position: absolute; width: 100%; text-align: center; line-height: 50px; color: #999; pointer-events: none;">Keine Termine</div>
                </div>

                <!-- Schwebende Termine Anzeige (GLOBAL - alle schwebenden Termine) -->
                <div class="schwebend-display schwebend-clickable" id="schwebendDisplay" style="display: none;" title="Klicken fÃ¼r Ãœbersicht aller schwebenden Termine">
                    <div class="schwebend-header">
                        <span class="schwebend-icon">â³</span>
                        <span class="schwebend-title">Schwebende Termine (Gesamt)</span>
                        <span class="schwebend-click-hint">ğŸ‘† Klicken fÃ¼r Details</span>
                    </div>
                    <div class="schwebend-info">
                        <div class="info-item">
                            <span class="label">Anzahl:</span>
                            <span id="schwebendAnzahl" class="value">0</span>
                        </div>
                        <div class="info-item">
                            <span class="label">Zeit:</span>
                            <span id="schwebendZeit" class="value">0 h</span>
                        </div>
                    </div>
                    <div class="progress-bar progress-bar-schwebend">
                        <div id="progressSchwebend" class="progress-segment progress-schwebend" style="width: 100%;"></div>
                    </div>
                    <p class="schwebend-hint">Alle noch nicht fest eingeplanten Termine â€“ unabhÃ¤ngig vom gewÃ¤hlten Datum.</p>
                </div>

                <div class="auslastung-legende">
                    <div class="legende-item">
                        <span class="color-box status-geplant"></span>
                        <span>Geplant</span>
                    </div>
                    <div class="legende-item">
                        <span class="color-box status-in-arbeit"></span>
                        <span>In Arbeit</span>
                    </div>
                    <div class="legende-item">
                        <span class="color-box status-abgeschlossen"></span>
                        <span>Abgeschlossen</span>
                    </div>
                    <div class="legende-item">
                        <span class="color-box status-schwebend"></span>
                        <span>Schwebend</span>
                    </div>
                </div>
            </div>

            <div class="form-section" id="mitarbeiterAuslastungSection" style="display: none;">
                <h3>Auslastung pro Mitarbeiter und Lehrling</h3>
                <div id="mitarbeiterAuslastungContainer"></div>
            </div>

            <!-- Nicht zugeordnete Termine und RestkapazitÃ¤t -->
            <div class="form-section" id="nichtZugeordnetSection" style="display: none;">
                <h3>âš ï¸ Nicht zugeordnete Arbeiten</h3>
                <p class="section-hint">Diese Termine haben noch keinen Mechaniker/Lehrling zugewiesen:</p>
                <div id="nichtZugeordnetContainer"></div>
                <div id="restkapazitaetInfo" class="restkapazitaet-box">
                    <h4>ğŸ“Š RestkapazitÃ¤t des Tages</h4>
                    <div id="restkapazitaetDetails"></div>
                </div>
            </div>

            <div class="auslastung-display">
                <h3>WochenÃ¼berblick (Mo-Fr)</h3>
                <div class="auslastung-info">
                    <div class="info-item">
                        <span class="label">Geplant:</span>
                        <span id="wocheGeplant" class="value">0 h</span>
                    </div>
                    <div class="info-item">
                        <span class="label">In Arbeit:</span>
                        <span id="wocheInArbeit" class="value">0 h</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Abgeschlossen:</span>
                        <span id="wocheAbgeschlossen" class="value">0 h</span>
                    </div>
                    <div class="info-item">
                        <span class="label">VerfÃ¼gbar:</span>
                        <span id="wocheVerfuegbar" class="value">0 h</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Auslastung:</span>
                        <span id="wocheProzent" class="value">0%</span>
                    </div>
                </div>

                <div class="progress-bar">
                    <div id="progressWocheGeplant" class="progress-segment progress-geplant" style="width: 0%;"></div>
                    <div id="progressWocheInArbeit" class="progress-segment progress-in-arbeit" style="width: 0%;"></div>
                    <div id="progressWocheAbgeschlossen" class="progress-segment progress-abgeschlossen" style="width: 0%;"></div>
                    <div id="progressWocheEmpty" class="progress-empty" style="position: absolute; width: 100%; text-align: center; line-height: 50px; color: #999; pointer-events: none;">Keine Termine</div>
                </div>
            </div>
        </template>

        <div id="einstellungen" class="tab-content" data-template-id="tab-template-einstellungen"></div>

        <template id="tab-template-einstellungen">
            <div class="page-header">
                <h2>âš™ï¸ Werkstatt-Einstellungen</h2>
                <p class="page-subtitle">Server-Verbindung, Datensicherung und Verwaltungsoptionen</p>
            </div>
            <div class="sub-tabs modern-tabs">
                <button class="sub-tab-button active" data-subtab="settingsServer">
                    <span class="tab-icon">ğŸŒ</span>
                    <span class="tab-label">Verbindung</span>
                </button>
                <button class="sub-tab-button" data-subtab="settingsBackup">
                    <span class="tab-icon">ğŸ’¾</span>
                    <span class="tab-label">Datensicherung</span>
                </button>
                <button class="sub-tab-button" data-subtab="settingsKunden">
                    <span class="tab-icon">ğŸ‘¥</span>
                    <span class="tab-label">Kundenverwaltung</span>
                </button>
                <button class="sub-tab-button" data-subtab="settingsSchichten">
                    <span class="tab-icon">âš¡</span>
                    <span class="tab-label">Schicht-Vorlagen</span>
                </button>
                <button class="sub-tab-button" data-subtab="settingsApi">
                    <span class="tab-icon">ğŸ¤–</span>
                    <span class="tab-label">KI / API</span>
                </button>
                <button class="sub-tab-button" data-subtab="settingsTablet">
                    <span class="tab-icon">ğŸ“±</span>
                    <span class="tab-label">Tablet-Steuerung</span>
                </button>
            </div>

            <div id="settingsServer" class="sub-tab-content active">
                <p>Hier die Basis-Arbeitszeit fÃ¼r die Auslastungsberechnung setzen.</p>
                <div class="form-section">
                    <h3>Server-Verbindung</h3>
                    <form id="serverConfigForm" class="form-row">
                        <div class="form-group">
                            <label>Server-IP-Adresse:</label>
                            <input type="text" id="server_ip" placeholder="z.B. 192.168.1.100 oder localhost" required>
                        </div>
                        <div class="form-group">
                            <label>Port:</label>
                            <input type="number" id="server_port" value="3001" min="1" max="65535" required>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <button type="submit" class="btn btn-primary">Verbindung speichern</button>
                        </div>
                    </form>
                    <p class="hint">
                        <strong>Aktuelle Verbindung:</strong> <span id="currentServerUrl">Wird geladen...</span><br>
                        <strong>Hinweis:</strong> FÃ¼r den Server-PC verwenden Sie "localhost". FÃ¼r Client-PCs verwenden Sie die IP-Adresse des Server-PCs (z.B. 192.168.1.100).
                    </p>
                    <button id="testConnectionBtn" class="btn btn-secondary">Verbindung testen</button>
                    <div id="connectionStatus" style="margin-top: 10px;"></div>
                </div>
            </div>

            <div id="settingsBackup" class="sub-tab-content">
                <h3>Datensicherung &amp; Server-Status</h3>

                <div class="dashboard-section">
                    <h3>Status</h3>
                    <div class="status-grid">
                        <div class="status-card">
                            <div class="status-label">Datenbank</div>
                            <div class="status-value" id="backupDbPath">-</div>
                        </div>
                        <div class="status-card">
                            <div class="status-label">Backup-Ordner</div>
                            <div class="status-value" id="backupDirPath">-</div>
                        </div>
                        <div class="status-card">
                            <div class="status-label">GrÃ¶ÃŸe</div>
                            <div class="status-value" id="backupDbSize">-</div>
                        </div>
                        <div class="status-card">
                            <div class="status-label">Letztes Backup</div>
                            <div class="status-value" id="backupLast">-</div>
                        </div>
                    </div>
                    <p class="hint">Daten liegen neben der Anwendung. Backups werden im Unterordner <strong>backups</strong> abgelegt.</p>
                </div>

                <div class="dashboard-section">
                    <h3>Backup erstellen &amp; verwalten</h3>
                    <div class="backup-actions">
                        <button id="createBackupBtn" class="btn-sparkle btn-sparkle-success">
                            <svg class="sparkle-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 0L14.59 9.41L24 12L14.59 14.59L12 24L9.41 14.59L0 12L9.41 9.41L12 0Z"/>
                            </svg>
                            <span class="btn-text">Backup erstellen</span>
                            <div class="dots-border"></div>
                        </button>
                        <button id="refreshBackupsBtn" class="btn btn-secondary">Aktualisieren</button>
                    </div>
                    <div class="backup-upload">
                        <label for="backupUploadInput" class="btn btn-secondary" style="margin-right: 10px;">Backup auswÃ¤hlen</label>
                        <input type="file" id="backupUploadInput" accept=".db" style="display:none">
                        <span id="backupUploadName" class="muted-text">Keine Datei ausgewÃ¤hlt</span>
                        <button id="uploadRestoreBtn" class="btn btn-primary">Hochladen &amp; laden</button>
                    </div>
                    <div class="termine-heute-liste">
                        <table id="backupTable">
                            <thead>
                                <tr>
                                    <th>Datei</th>
                                    <th>GrÃ¶ÃŸe</th>
                                    <th>Erstellt</th>
                                    <th>Aktionen</th>
                                </tr>
                            </thead>
                            <tbody id="backupTableBody">
                                <tr><td colspan="4" class="loading">Backups werden geladen...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="settingsKunden" class="sub-tab-content">
                <h3>Kundenverwaltung</h3>

                <div class="form-section">
                    <h3>Neuer Kunde</h3>
                    <form id="kundenForm">
                        <div class="form-row">
                            <div class="form-group" style="flex: 2;">
                                <label>Name: *</label>
                                <input type="text" id="kunde_name" required placeholder="Vor- und Nachname">
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label>Locosoft ID:</label>
                                <input type="text" id="locosoft_id" placeholder="z.B. LS001">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Telefon:</label>
                                <input type="tel" id="telefon" placeholder="z.B. 0221 123456">
                            </div>
                            <div class="form-group">
                                <label>Email:</label>
                                <input type="email" id="email" placeholder="kunde@beispiel.de">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Adresse:</label>
                            <textarea id="adresse" rows="2" placeholder="StraÃŸe, PLZ Ort"></textarea>
                        </div>

                        <h4 style="margin-top: 20px; margin-bottom: 15px; color: #4a90e2; border-bottom: 2px solid #e0e0e0; padding-bottom: 8px;">ğŸš— Fahrzeugdaten</h4>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Kennzeichen:</label>
                                <input type="text" id="kunde_kennzeichen" placeholder="z.B. K-AB 1234" style="text-transform: uppercase;">
                            </div>
                            <div class="form-group">
                                <label>Fahrzeugtyp:</label>
                                <input type="text" id="kunde_fahrzeugtyp" placeholder="z.B. VW Golf 7, BMW 320d">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>VIN/FIN (Fahrzeug-Ident-Nr.):</label>
                            <input type="text" id="kunde_vin" maxlength="17" placeholder="z.B. WVWZZZ3CZWE123456" style="text-transform: uppercase;">
                        </div>

                        <button type="submit" class="btn-sparkle btn-sparkle-success">
                            <svg class="sparkle-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 0L14.59 9.41L24 12L14.59 14.59L12 24L9.41 14.59L0 12L9.41 9.41L12 0Z"/>
                            </svg>
                            <span class="btn-text">Kunde anlegen</span>
                            <div class="dots-border"></div>
                        </button>
                    </form>
                </div>

                <div class="import-section">
                    <h3>ğŸ“¥ Kunden Import</h3>
                    <p>Excel-Datei (.xlsx) mit Spalten: <strong>Name, Telefon, Email, Adresse, Kennzeichen, Fahrzeugtyp</strong></p>
                    <p class="import-hint">ğŸ’¡ Ein Kunde kann mehrere Fahrzeuge haben - einfach mehrere Zeilen mit gleichem Namen anlegen.</p>
                    
                    <div class="import-file-section">
                        <label class="file-upload-label">
                            <input type="file" id="excelFileInput" accept=".xlsx,.xls,.csv" style="display:none">
                            <span class="btn btn-primary">ğŸ“ Excel-Datei auswÃ¤hlen</span>
                        </label>
                        <span id="selectedFileName" class="selected-file-name"></span>
                    </div>
                    
                    <div id="importPreview" class="import-preview" style="display:none">
                        <h4>ğŸ“‹ Import-Vorschau</h4>
                        <div id="importStats" class="import-stats"></div>
                        <div id="importWarnings" class="import-warnings"></div>
                        <div id="importPreviewTable" class="import-preview-table"></div>
                        <div class="import-actions">
                            <button id="confirmImportBtn" class="btn btn-success">âœ… Import bestÃ¤tigen</button>
                            <button id="cancelImportBtn" class="btn btn-secondary">âŒ Abbrechen</button>
                        </div>
                    </div>
                    
                    <details class="json-import-details">
                        <summary>Alternativer JSON-Import</summary>
                        <textarea id="importData" rows="5" placeholder='[{"name":"Max Mustermann","telefon":"030123456","email":"max@example.com","adresse":"Musterstr. 1","kennzeichen":"B-XX 1234"}]'></textarea>
                        <button id="importBtn" class="btn btn-secondary">JSON Import starten</button>
                    </details>
                </div>

                <div class="table-section">
                    <h3>Kundenliste</h3>
                    <div class="kunden-suche-container">
                        <div class="kunden-suche-wrapper">
                            <input type="text" id="kundenListeSuche" class="kunden-suche-input" 
                                   placeholder="ğŸ” Kunde suchen (Name, Kennzeichen, Telefon...)" 
                                   autocomplete="off">
                            <button id="kundenSucheClearBtn" class="kunden-suche-clear" style="display:none">âœ•</button>
                        </div>
                        <span id="kundenAnzahlBadge" class="kunden-anzahl-badge"></span>
                    </div>
                    <table id="kundenTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Telefon</th>
                                <th>Email</th>
                                <th>Kennzeichen</th>
                                <th>Fahrzeug</th>
                                <th>Locosoft ID</th>
                                <th>Aktionen</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div id="settingsSchichten" class="sub-tab-content">
                <h3>âš¡ Schicht-Vorlagen verwalten</h3>
                <p>Erstellen und bearbeiten Sie wiederverwendbare Schichtmuster fÃ¼r schnelle Arbeitszeitplanung.</p>

                <div class="form-section" style="margin-bottom: 20px;">
                    <h4>Neue Schicht-Vorlage erstellen</h4>
                    <form id="schichtTemplateForm" class="form-row">
                        <div class="form-group">
                            <label>Name:</label>
                            <input type="text" id="schichtName" placeholder="z.B. FrÃ¼hschicht" required>
                        </div>
                        <div class="form-group">
                            <label>Beschreibung:</label>
                            <input type="text" id="schichtBeschreibung" placeholder="Optional">
                        </div>
                        <div class="form-group">
                            <label>Arbeitszeit Start:</label>
                            <input type="time" id="schichtStart" value="08:00" required>
                        </div>
                        <div class="form-group">
                            <label>Arbeitszeit Ende:</label>
                            <input type="time" id="schichtEnde" value="16:30" required>
                        </div>
                        <div class="form-group">
                            <label>Farbe:</label>
                            <input type="color" id="schichtFarbe" value="#10b981">
                        </div>
                        <div class="form-group">
                            <label>Sortierung:</label>
                            <input type="number" id="schichtSortierung" value="1" min="1" max="99">
                        </div>
                        <div class="form-group" style="align-self: flex-end;">
                            <button type="submit" class="btn btn-primary">
                                <span id="schichtFormButtonText">â• Erstellen</span>
                            </button>
                            <button type="button" class="btn btn-secondary" id="schichtFormCancel" style="display:none; margin-left: 10px;">
                                Abbrechen
                            </button>
                        </div>
                    </form>
                </div>

                <div class="form-section">
                    <h4>Vorhandene Schichten</h4>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th style="width: 30px;">#</th>
                                <th>Name</th>
                                <th>Beschreibung</th>
                                <th style="width: 100px;">Start</th>
                                <th style="width: 100px;">Ende</th>
                                <th style="width: 80px;">Farbe</th>
                                <th style="width: 80px;">Sort.</th>
                                <th style="width: 120px;">Aktionen</th>
                            </tr>
                        </thead>
                        <tbody id="schichtTemplateTableBody">
                            <tr>
                                <td colspan="8" style="text-align: center; padding: 20px; color: #999;">
                                    Lade Schicht-Vorlagen...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="settingsApi" class="sub-tab-content">
                <h3>ğŸ¤– KI & API-Einstellungen</h3>
                
                <!-- KI-Funktionen Ein/Aus Schalter -->
                <div class="form-section ki-toggle-section" style="margin-bottom: 20px;">
                    <div class="ki-master-toggle">
                        <div class="ki-toggle-header">
                            <h3 style="margin: 0;">ğŸ”Œ KI-Funktionen</h3>
                            <label class="switch-toggle">
                                <input type="checkbox" id="kiEnabledToggle" checked>
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <p class="hint" style="margin: 10px 0 0 0;">
                            Aktiviert oder deaktiviert alle KI-bezogenen Funktionen in der Anwendung.<br>
                            Bei Deaktivierung werden folgende Elemente ausgeblendet:
                        </p>
                        <ul class="ki-features-list" style="margin: 10px 0 0 20px; font-size: 0.9em; color: #666;">
                            <li>ğŸ¤– <strong>KI-Tagesvorschlag</strong> und <strong>KI-Wochenverteilung</strong> Buttons (in Planung & Zuweisung)</li>
                            <li>ğŸ¤– <strong>KI-Hilfe</strong> Checkbox beim Erstellen von Terminen</li>
                        </ul>
                    </div>
                </div>

                <div class="form-section ki-mode-section" style="margin-bottom: 20px;">
                    <h3 style="margin: 0 0 10px 0;">ğŸ§  KI-Modus</h3>

                    <div id="kiModeStatus" class="ki-mode-status" style="margin-bottom: 15px; padding: 12px 15px; border-radius: 8px; background: #e8f5e9; border: 1px solid #a5d6a7;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span id="kiModeStatusIcon" style="font-size: 1.3em;">ğŸŸ¢</span>
                            <div>
                                <strong id="kiModeStatusText">Aktiv: Lokale KI</strong>
                                <div id="kiModeStatusHint" style="font-size: 0.85em; color: #666; margin-top: 2px;">
                                    Nutzt Heuristiken auf dem Server (kein Internet erforderlich)
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label for="kiModeSelect">Betriebsmodus:</label>
                            <select id="kiModeSelect">
                                <option value="local">Lokal (leicht, ohne Internet)</option>
                                <option value="external">Extern (lokaler KI-Service im Netzwerk)</option>
                                <option value="openai">OpenAI (Cloud, benÃ¶tigt API-Key)</option>
                            </select>
                        </div>
                    </div>
                    <p class="hint" style="margin: 0;">
                        Lokal nutzt einfache Heuristiken. Extern nutzt einen separaten KI-Service im Netzwerk.
                    </p>
                </div>

                <div class="form-section external-ki-section external-only" style="margin-bottom: 20px;">
                    <h3 style="margin: 0 0 10px 0;">ğŸŒ Externe KI (Netzwerk)</h3>
                    <p class="hint" style="margin-bottom: 10px;">
                        Der KI-Service wird automatisch per Netzwerk gefunden. Falls er nicht entdeckt wird,
                        kannst du eine IP/URL als Fallback eintragen.
                    </p>

                    <div id="externalKiStatus" style="margin-bottom: 12px; padding: 12px 15px; border-radius: 8px; background: #f5f5f5; border: 1px solid #ddd;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span id="externalKiStatusIcon" style="font-size: 1.3em;">âšª</span>
                            <div id="externalKiStatusText">
                                <strong>Status wird geprÃ¼ft...</strong>
                            </div>
                        </div>
                    </div>

                    <form id="externalKiForm">
                        <div class="form-group">
                            <label for="ki_external_url">Fallback IP/URL:</label>
                            <input type="text" id="ki_external_url" placeholder="http://192.168.1.50:5000">
                            <small style="display: block; color: #666; margin-top: 5px;">
                                Beispiel: <strong>192.168.1.50:5000</strong> (Basis-URL ohne <em>/api</em>)
                            </small>
                        </div>
                        <div class="api-key-actions">
                            <button type="submit" class="btn btn-primary">ğŸ’¾ Fallback speichern</button>
                            <button type="button" id="testExternalKiBtn" class="btn btn-secondary">ğŸ” Status prÃ¼fen</button>
                        </div>
                    </form>
                </div>

                <div class="form-section realtime-toggle-section" style="margin-bottom: 20px;">
                    <div class="ki-master-toggle">
                        <div class="ki-toggle-header">
                            <h3 style="margin: 0;">âš¡ Echtzeit-Updates</h3>
                            <label class="switch-toggle">
                                <input type="checkbox" id="realtimeEnabledToggle" checked>
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <p class="hint" style="margin: 10px 0 0 0;">
                            Aktiviert Live-Updates Ã¼ber WebSocket (z.B. Termine, Auslastung, Dashboard).<br>
                            Bei Deaktivierung werden Daten nur bei manuellen Aktionen aktualisiert.
                        </p>
                    </div>
                </div>

                <div class="form-section smart-scheduling-toggle-section" style="margin-bottom: 20px;">
                    <div class="ki-master-toggle">
                        <div class="ki-toggle-header">
                            <h3 style="margin: 0;">ğŸ§­ Smart Scheduling</h3>
                            <label class="switch-toggle">
                                <input type="checkbox" id="smartSchedulingToggle" checked>
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <p class="hint" style="margin: 10px 0 0 0;">
                            Aktiviert lokale Termin-VorschlÃ¤ge fÃ¼r Tages- und Wochenplanung (auch ohne OpenAI).
                        </p>
                    </div>
                </div>

                <div class="form-section anomaly-toggle-section" style="margin-bottom: 20px;">
                    <div class="ki-master-toggle">
                        <div class="ki-toggle-header">
                            <h3 style="margin: 0;">ğŸ›¡ï¸ Anomalie-Erkennung</h3>
                            <label class="switch-toggle">
                                <input type="checkbox" id="anomalyDetectionToggle" checked>
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <p class="hint" style="margin: 10px 0 0 0;">
                            Warnungen zu unrealistischen Zeiten, Doppelbuchungen und Ãœberlastung anzeigen.
                        </p>
                    </div>
                </div>

                <div class="form-section ki-training-section" style="margin-bottom: 20px;">
                    <h3 style="margin: 0 0 10px 0;">ğŸ“Š KI-Trainingsdaten</h3>
                    <p class="hint" style="margin-bottom: 15px;">
                        Ãœberwachen und bereinigen Sie die Daten, mit denen die lokale KI trainiert wird.
                        AusreiÃŸer (z.B. ungewÃ¶hnlich lange/kurze Zeiten) werden automatisch erkannt.
                    </p>

                    <div id="kiTrainingStatus" style="padding: 12px 15px; border-radius: 8px; background: #f5f5f5; border: 1px solid #ddd; margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.3em;">ğŸ“ˆ</span>
                            <div id="kiTrainingStatusText">
                                <strong>Lade Trainingsdaten...</strong>
                            </div>
                        </div>
                    </div>

                    <div id="externalKiTrainingStatus" class="external-only" style="padding: 12px 15px; border-radius: 8px; background: #e8f5e9; border: 2px solid #4caf50; margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.3em;">ğŸŒ</span>
                            <div id="externalKiTrainingStatusText">
                                <strong>Externes KI-Training wird geprÃ¼ft...</strong>
                            </div>
                        </div>
                    </div>

                    <!-- Externe KI Training Button - prominent platziert -->
                    <div id="externalKiTrainingContainer" style="margin-bottom: 15px; padding: 15px; background: #e3f2fd; border-left: 4px solid #2196f3; border-radius: 4px;">
                        <h4 style="margin: 0 0 8px 0; color: #1976d2;">ğŸ” Externe KI-Training</h4>
                        <p id="externalKiTrainingHint" style="margin: 0 0 12px 0; font-size: 0.9em; color: #666;">
                            Das externe KI-Modell wird automatisch im Hintergrund trainiert.
                        </p>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <button type="button" id="btnRetrainExternalModel" class="btn-primary" style="padding: 10px 20px; font-weight: bold;">
                                ğŸ” Training jetzt starten
                            </button>
                            <button type="button" id="btnNotifyBackendUrl" class="btn-secondary" style="padding: 10px 20px;" onclick="app.notifyExternalBackendUrl()">
                                ğŸ“¡ Backend-URL Ã¼bertragen
                            </button>
                        </div>
                        <div id="externalTrainingInfo" style="margin-top: 12px; padding: 10px; background: #f5f5f5; border-radius: 4px; font-size: 0.85em; color: #666; display: none;">
                            ğŸ’¡ <strong>Hinweis:</strong> Das Training lÃ¤uft automatisch alle 24 Stunden. Ein manuelles Training ist nur nÃ¶tig, wenn Sie neue Daten sofort einbeziehen mÃ¶chten.
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px;">
                        <button type="button" id="btnExcludeOutliers" class="btn-secondary" style="padding: 8px 16px;">
                            ğŸš« Alle AusreiÃŸer ausschlieÃŸen
                        </button>
                        <button type="button" id="btnRetrainModel" class="btn-secondary" style="padding: 8px 16px;">
                            ğŸ”„ Modell neu trainieren
                        </button>
                        <button type="button" id="btnShowTrainingDetails" class="btn-secondary" style="padding: 8px 16px;">
                            ğŸ“‹ Details anzeigen
                        </button>
                    </div>

                    <div id="kiTrainingDetails" style="display: none; max-height: 400px; overflow-y: auto; border: 1px solid #ddd; border-radius: 8px; background: #fafafa;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.9em;">
                            <thead style="position: sticky; top: 0; background: #e0e0e0;">
                                <tr>
                                    <th style="padding: 8px; text-align: left; border-bottom: 1px solid #ccc;">Datum</th>
                                    <th style="padding: 8px; text-align: left; border-bottom: 1px solid #ccc;">Arbeit</th>
                                    <th style="padding: 8px; text-align: right; border-bottom: 1px solid #ccc;">Zeit (Min)</th>
                                    <th style="padding: 8px; text-align: center; border-bottom: 1px solid #ccc;">Status</th>
                                    <th style="padding: 8px; text-align: center; border-bottom: 1px solid #ccc;">Aktion</th>
                                </tr>
                            </thead>
                            <tbody id="kiTrainingTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="form-section" id="kiApiKeySection">
                    <h3>ChatGPT / OpenAI API</h3>
                    <p class="hint" style="margin-bottom: 15px;">
                        Mit einem ChatGPT API-Key kÃ¶nnen zukÃ¼nftig KI-Funktionen genutzt werden, 
                        z.B. automatische Arbeitsbeschreibungen, ZeitschÃ¤tzungen oder Kundenassistenz.
                    </p>
                    
                    <div id="apiKeyStatus" class="api-key-status">
                        <div class="status-indicator not-configured">
                            <span class="status-icon">âšª</span>
                            <span class="status-text">Kein API-Key konfiguriert</span>
                        </div>
                    </div>
                    
                    <form id="chatgptApiKeyForm" class="api-key-form">
                        <div class="form-group">
                            <label for="chatgpt_api_key">OpenAI API-Key:</label>
                            <div class="api-key-input-wrapper">
                                <input type="password" 
                                       id="chatgpt_api_key" 
                                       placeholder="sk-..." 
                                       autocomplete="off"
                                       class="api-key-input">
                                <button type="button" id="toggleApiKeyVisibility" class="btn btn-icon" title="API-Key anzeigen/verbergen">
                                    ğŸ‘ï¸
                                </button>
                            </div>
                            <small style="display: block; color: #666; margin-top: 5px;">
                                Der API-Key wird verschlÃ¼sselt in der Datenbank gespeichert.<br>
                                <a href="https://platform.openai.com/api-keys" target="_blank" rel="noopener">â†’ OpenAI API-Keys verwalten</a>
                            </small>
                        </div>
                        
                        <div class="api-key-actions">
                            <button type="submit" class="btn btn-primary">ğŸ’¾ API-Key speichern</button>
                            <button type="button" id="testApiKeyBtn" class="btn btn-secondary">ğŸ” Verbindung testen</button>
                            <button type="button" id="deleteApiKeyBtn" class="btn btn-danger">ğŸ—‘ï¸ API-Key lÃ¶schen</button>
                        </div>
                    </form>
                    
                    <div id="apiKeyTestResult" class="api-test-result" style="display: none;"></div>
                </div>
                
                <div class="form-section" style="margin-top: 20px;">
                    <h3>â„¹ï¸ Hinweise zur API-Nutzung</h3>
                    <ul class="info-list">
                        <li>ğŸ” <strong>Sicherheit:</strong> Der API-Key wird Base64-kodiert in der lokalen Datenbank gespeichert.</li>
                        <li>ğŸ’° <strong>Kosten:</strong> Die Nutzung der OpenAI API ist kostenpflichtig. PrÃ¼fen Sie Ihre Nutzung regelmÃ¤ÃŸig.</li>
                        <li>ğŸŒ <strong>Verbindung:</strong> FÃ¼r KI-Funktionen ist eine aktive Internetverbindung erforderlich.</li>
                        <li>ğŸ“Š <strong>Datenschutz:</strong> Bei KI-Anfragen werden Daten an OpenAI Ã¼bermittelt. Achten Sie auf sensible Kundendaten.</li>
                    </ul>
                </div>
            </div>

            <div id="settingsTablet" class="sub-tab-content">
                <h3>ğŸ“± Tablet-Steuerung</h3>
                <p>Zentrale Verwaltung der Tablet-Display-Einstellungen fÃ¼r alle verbundenen Tablet-Apps.</p>

                <div class="form-section" style="margin-bottom: 25px;">
                    <h3>â° Automatische Display-Steuerung</h3>
                    <p class="hint" style="margin-bottom: 15px;">
                        Legen Sie fest, wann die Tablet-Displays automatisch ein- und ausgeschaltet werden sollen.
                        Die Tablets laden die Einstellungen vom Server und aktualisieren sich automatisch.
                    </p>

                    <form id="tabletDisplayForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="display_einschaltzeit">â° Display einschalten um:</label>
                                <input type="time" id="display_einschaltzeit" value="07:30" required>
                                <small style="display: block; color: #666; margin-top: 5px;">
                                    Tablets schalten sich automatisch zur angegebenen Uhrzeit ein
                                </small>
                            </div>
                            <div class="form-group">
                                <label for="display_ausschaltzeit">ğŸŒ™ Display ausschalten um:</label>
                                <input type="time" id="display_ausschaltzeit" value="18:10" required>
                                <small style="display: block; color: #666; margin-top: 5px;">
                                    Tablets schalten sich automatisch zur angegebenen Uhrzeit aus
                                </small>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary" style="margin-top: 10px;">
                            ğŸ’¾ Einschaltzeiten speichern
                        </button>
                    </form>
                </div>

                <div class="form-section" style="margin-bottom: 25px;">
                    <h3>ğŸ® Manuelle Steuerung</h3>
                    <p class="hint" style="margin-bottom: 15px;">
                        Ãœberschreiben Sie die automatische Steuerung und schalten Sie alle Tablets sofort manuell ein oder aus.
                    </p>

                    <div id="tabletDisplayStatus" style="margin-bottom: 15px; padding: 15px; border-radius: 8px; background: #f5f5f5; border: 1px solid #ddd;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <span id="tabletDisplayStatusIcon" style="font-size: 1.5em;">âšª</span>
                            <div>
                                <strong id="tabletDisplayStatusText">Status wird geladen...</strong>
                                <div id="tabletDisplayStatusHint" style="font-size: 0.85em; color: #666; margin-top: 3px;"></div>
                            </div>
                        </div>
                    </div>

                    <div class="tablet-control-buttons" style="display: flex; gap: 10px;">
                        <button id="tabletDisplayAutoBtn" class="btn btn-secondary" style="flex: 1;">
                            ğŸ”„ Automatik
                        </button>
                        <button id="tabletDisplayOnBtn" class="btn btn-success" style="flex: 1;">
                            ğŸ’¡ Alle einschalten
                        </button>
                        <button id="tabletDisplayOffBtn" class="btn btn-danger" style="flex: 1;">
                            ğŸŒ™ Alle ausschalten
                        </button>
                    </div>
                </div>

                <div class="form-section">
                    <h3>â„¹ï¸ Hinweise</h3>
                    <ul class="info-list">
                        <li>ğŸ”„ <strong>Synchronisation:</strong> Tablets laden die Einstellungen alle 30 Sekunden vom Server.</li>
                        <li>â° <strong>Automatik:</strong> Im Automatik-Modus schalten sich die Displays nach den definierten Zeiten ein/aus.</li>
                        <li>ğŸ® <strong>Manuell:</strong> Manuelle Steuerung Ã¼berschreibt die Automatik bis "Automatik" wieder aktiviert wird.</li>
                        <li>ğŸ“± <strong>Lokale Einstellungen:</strong> Tablets kÃ¶nnen weiterhin lokal konfiguriert werden (Fallback bei Server-Ausfall).</li>
                        <li>ğŸ”Œ <strong>Offline-Betrieb:</strong> Bei Verbindungsausfall nutzen Tablets ihre lokalen Einstellungen.</li>
                    </ul>
                </div>
            </div>
        </template>

        <!-- Neuer Tab fÃ¼r Drag & Drop Planung -->
        <div id="auslastung-dragdrop" class="tab-content" data-template-id="tab-template-auslastung-dragdrop"></div>

        <template id="tab-template-auslastung-dragdrop">
            <div class="page-header">
                <h2>ğŸ—ï¸ Planung & Zuweisung (Beta)</h2>
                <p class="page-subtitle">Drag & Drop Terminplanung mit Zeitleiste</p>
            </div>

            <!-- Auslastungsbalken fÃ¼r den ausgewÃ¤hlten Tag -->
            <div class="planung-auslastung-bar" id="planungAuslastungBar">
                <div class="planung-auslastung-label">
                    <span>ğŸ“Š Tagesauslastung:</span>
                    <span id="planungAuslastungProzent">0%</span>
                </div>
                <div class="planung-auslastung-track">
                    <div class="planung-auslastung-fill" id="planungAuslastungFill" style="width: 0%"></div>
                </div>
                <div class="planung-auslastung-details" id="planungAuslastungDetails">
                    <span id="planungAuslastungMinuten">0 / 0 min</span>
                </div>
            </div>

            <div class="auslastung-navigation">
                <div class="nav-row">
                    <button type="button" id="planungPrevTag" class="btn btn-nav" title="Vorheriger Tag">â—€ Tag</button>
                    <div class="form-group" style="margin: 0;">
                        <input type="date" id="auslastungDragDropDatum">
                    </div>
                    <button type="button" id="planungNextTag" class="btn btn-nav" title="NÃ¤chster Tag">Tag â–¶</button>
                    <button type="button" id="planungHeuteBtn" class="btn btn-today" title="Heute">Heute</button>
                </div>
                <div class="nav-row">
                    <button type="button" id="planungPrevWoche" class="btn btn-nav-week" title="Vorherige Woche">â—€â—€ Woche</button>
                    <span id="planungWocheInfo" class="woche-info"></span>
                    <span id="planungAktuellerTag" class="aktueller-tag-badge"></span>
                    <button type="button" id="planungNextWoche" class="btn btn-nav-week" title="NÃ¤chste Woche">Woche â–¶â–¶</button>
                </div>
            </div>
            
            <div class="header-actions" style="margin-top: 15px;">
                <div class="planning-controls">
                    <div class="raster-control">
                        <label>Raster:</label>
                        <select id="planungRasterSelect" onchange="app.setPlanungRaster(this.value)">
                            <option value="5">5 min</option>
                            <option value="10">10 min</option>
                            <option value="15" selected>15 min</option>
                            <option value="30">30 min</option>
                        </select>
                    </div>
                    <span id="planungAenderungenCount" class="aenderungen-badge" style="display: none;">0 Ã„nderungen</span>
                    <button class="btn btn-success" id="planungSpeichernBtn" onclick="app.savePlanungAenderungen()" disabled>
                        ğŸ’¾ Speichern
                    </button>
                    <button class="btn btn-secondary" id="planungVerwerfenBtn" onclick="app.verwerfePlanungAenderungen()" style="display: none;">
                        â†©ï¸ Verwerfen
                    </button>
                    <div class="ki-planung-controls ki-element">
                        <button class="btn btn-ki" id="kiTagesplanungBtn" onclick="app.requestKITagesplanung()" title="KI optimiert die heutige Planung">
                            ğŸ¤– KI-Tagesvorschlag
                        </button>
                        <button class="btn btn-ki-secondary" id="kiWochenplanungBtn" onclick="app.requestKIWochenplanung()" title="KI verteilt schwebende Termine auf die Woche">
                            ğŸ“… KI-Wochenverteilung
                        </button>
                    </div>
                </div>
            </div>

            <div class="planning-layout">
                <!-- Hauptbereich: Timeline -->
                <div class="timeline-panel">
                    <h3>â° Zeitplan</h3>
                    <div class="timeline-container">
                        <!-- Zeitachse Header -->
                        <div class="timeline-header" id="timelineHeader">
                            <div class="timeline-label">Mitarbeiter</div>
                            <div class="timeline-hours" id="timelineHours">
                                <!-- Stunden werden per JS generiert -->
                            </div>
                        </div>
                        <!-- Mitarbeiter Zeitbahnen -->
                        <div class="timeline-body" id="timelineBody">
                            <!-- Mitarbeiter Rows werden hier generiert -->
                        </div>
                    </div>
                </div>

                <!-- Unter dem Zeitplan: Nicht zugeordnete Termine (zuerst) -->
                <div class="unassigned-panel">
                    <h3>ğŸ“‹ Nicht zugeordnet</h3>
                    <div id="dragDropNichtZugeordnet" class="drop-zone source-zone" data-mitarbeiter-id="null">
                        <!-- Termine werden hier eingefÃ¼gt -->
                    </div>
                </div>

                <!-- Schwebende Termine (mit Balken-Darstellung) -->
                <div class="schwebende-panel">
                    <div class="schwebende-header">
                        <h3>â¸ï¸ Schwebende Termine</h3>
                        <div class="schwebende-controls">
                            <select id="schwebendeSortierung" onchange="app.sortSchwebendeTermine(this.value)">
                                <option value="datum">Nach Datum</option>
                                <option value="dauer">Nach Dauer</option>
                                <option value="kunde">Nach Kunde</option>
                                <option value="dringlichkeit">Nach Dringlichkeit</option>
                                <option value="prioritaet">Nach PrioritÃ¤t</option>
                            </select>
                            <span id="schwebendeCount" class="schwebende-count">0 Termine</span>
                        </div>
                    </div>
                    <div id="schwebendeTermineContainer" class="schwebende-container">
                        <!-- Schwebende Termine als Balken werden hier eingefÃ¼gt -->
                    </div>
                </div>

                <!-- ÃœberfÃ¤llige Termine (aus Vortagen, nicht abgeschlossen) -->
                <div class="ueberfaellige-panel">
                    <div class="ueberfaellige-header">
                        <h3>âš ï¸ ÃœberfÃ¤llige Termine</h3>
                        <div class="ueberfaellige-controls">
                            <span id="ueberfaelligeCount" class="ueberfaellige-count">0 Termine</span>
                            <button class="btn btn-sm btn-secondary" onclick="app.loadUeberfaelligeTermine()" title="Aktualisieren">
                                ğŸ”„
                            </button>
                        </div>
                    </div>
                    <p class="ueberfaellige-hint">Termine aus vergangenen Tagen, die noch nicht abgeschlossen wurden.</p>
                    <div id="ueberfaelligeTermineContainer" class="ueberfaellige-container">
                        <!-- ÃœberfÃ¤llige Termine werden hier eingefÃ¼gt -->
                        <div class="empty-state">Keine Ã¼berfÃ¤lligen Termine</div>
                    </div>
                </div>
            </div>
        </template>

        <!-- ============================================================== -->
        <!-- TEILE-BESTELLEN TAB -->
        <!-- ============================================================== -->
        <div id="teile-bestellen" class="tab-content" data-template-id="tab-template-teile-bestellen"></div>

        <template id="tab-template-teile-bestellen">
            <div class="page-header">
                <h2>ğŸ›’ Teile-Bestellen</h2>
                <p class="page-subtitle">Ãœbersicht Ã¼ber benÃ¶tigte Teile fÃ¼r anstehende Termine</p>
            </div>

            <!-- Statistik-Karten -->
            <div class="teile-statistik">
                <div class="teile-stat-card schwebend">
                    <span class="stat-icon">â¸ï¸</span>
                    <span class="stat-zahl" id="teileSchwebendCount">0</span>
                    <span class="stat-label">Schwebend</span>
                </div>
                <div class="teile-stat-card dringend">
                    <span class="stat-icon">ğŸ”´</span>
                    <span class="stat-zahl" id="teileDringendCount">0</span>
                    <span class="stat-label">Dringend</span>
                </div>
                <div class="teile-stat-card diese-woche">
                    <span class="stat-icon">ğŸŸ¡</span>
                    <span class="stat-zahl" id="teileDieseWocheCount">0</span>
                    <span class="stat-label">Diese Woche</span>
                </div>
                <div class="teile-stat-card naechste-woche">
                    <span class="stat-icon">ğŸŸ¢</span>
                    <span class="stat-zahl" id="teileNaechsteWocheCount">0</span>
                    <span class="stat-label">NÃ¤chste Woche</span>
                </div>
                <div class="teile-stat-card bestellt">
                    <span class="stat-icon">ğŸ“¦</span>
                    <span class="stat-zahl" id="teileBestelltCount">0</span>
                    <span class="stat-label">Bestellt</span>
                </div>
            </div>

            <!-- Filter und Aktionen -->
            <div class="teile-aktionen">
                <div class="teile-filter">
                    <label>
                        <input type="checkbox" id="teileFilterOffen" checked> Offen
                    </label>
                    <label>
                        <input type="checkbox" id="teileFilterBestellt" checked> Bestellt
                    </label>
                    <label>
                        <input type="checkbox" id="teileFilterGeliefert"> Geliefert
                    </label>
                    <select id="teileFilterZeitraum">
                        <option value="7">NÃ¤chste 7 Tage</option>
                        <option value="14">NÃ¤chste 14 Tage</option>
                        <option value="30">NÃ¤chste 30 Tage</option>
                        <option value="alle">Alle anzeigen</option>
                    </select>
                </div>
                <div class="teile-buttons">
                    <button type="button" class="btn btn-secondary" onclick="app.teileAlleAuswaehlen()">
                        ğŸ“‹ Alle auswÃ¤hlen
                    </button>
                    <button type="button" class="btn btn-primary" onclick="app.teileAlsBestellt()">
                        âœ… Auswahl als bestellt
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="app.teileDrucken()">
                        ğŸ–¨ï¸ Drucken
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="app.loadTeileBestellungen()">
                        ğŸ”„ Aktualisieren
                    </button>
                </div>
            </div>

            <!-- Bestellliste -->
            <div class="teile-liste" id="teileBestellListe">
                <!-- Wird per JavaScript gefÃ¼llt -->
                <div class="teile-loading">
                    <span class="spinner"></span> Lade Teile-Bestellungen...
                </div>
            </div>

            <!-- Neue Bestellung hinzufÃ¼gen -->
            <div class="teile-neu-bestellung">
                <h3>â• Neue Bestellung hinzufÃ¼gen</h3>
                <div class="teile-neu-form">
                    <div class="teile-zuordnung-wrapper">
                        <select id="teileNeuZuordnung" onchange="app.teileZuordnungGeaendert()">
                            <option value="termin">ğŸ“… Termin</option>
                            <option value="kunde">ğŸ‘¤ Nur Kunde (ohne Termin)</option>
                        </select>
                        <select id="teileNeuTermin" onfocus="app.loadTermineFuerTeileDropdownLazy()" required>
                            <option value="">-- Termin auswÃ¤hlen (klicken zum Laden) --</option>
                        </select>
                        <select id="teileNeuKunde" onfocus="app.loadKundenFuerTeileDropdownLazy()" style="display: none;">
                            <option value="">-- Kunde auswÃ¤hlen (klicken zum Laden) --</option>
                        </select>
                    </div>
                    <input type="text" id="teileNeuName" placeholder="Teilename" required>
                    <input type="text" id="teileNeuOE" placeholder="OE-Nummer (optional)">
                    <input type="number" id="teileNeuMenge" value="1" min="1" placeholder="Menge">
                    <input type="text" id="teileNeuArbeit" placeholder="FÃ¼r Arbeit (optional)">
                    <button type="button" class="btn btn-primary" onclick="app.teileNeuHinzufuegen()">
                        â• HinzufÃ¼gen
                    </button>
                </div>
            </div>
        </template>

        <!-- ================================================
             INTERN TAB - Mitarbeiter ArbeitsÃ¼bersicht
             ================================================ -->
        <div id="intern" class="tab-content" data-template-id="tab-template-intern"></div>

        <template id="tab-template-intern">
            <div class="page-header intern-header">
                <div class="intern-header-left">
                    <h2>ğŸ‘· Intern â€“ Team-Ãœbersicht</h2>
                    <p class="page-subtitle">Aktuelle Arbeiten aller Mitarbeiter und Lehrlinge auf einen Blick</p>
                </div>
                <div class="intern-header-right">
                    <button type="button" class="btn btn-secondary btn-sm" id="internRefreshBtn" title="Aktualisieren">
                        ğŸ”„ Aktualisieren
                    </button>
                    <button type="button" class="btn btn-primary btn-sm" id="internTabletModeBtn" title="Tablet-Modus">
                        ğŸ“± Tablet-Modus
                    </button>
                </div>
            </div>

            <!-- Tablet-Modus Mini-Header (nur sichtbar im Tablet-Modus) -->
            <div id="internTabletHeader" class="intern-tablet-header" style="display: none;">
                <span class="tablet-title">ğŸ‘· Team-Ãœbersicht</span>
                <div class="tablet-actions">
                    <button type="button" class="btn-tablet" id="internTabletRefresh" title="Aktualisieren">ğŸ”„</button>
                    <button type="button" class="btn-tablet btn-tablet-exit" id="internTabletExitBtn" title="Tablet-Modus beenden">âœ•</button>
                </div>
            </div>

            <!-- Team-Sections Wrapper fÃ¼r Tablet 2x2 Grid -->
            <div class="intern-team-sections">
                <!-- Alle Mitarbeiter Kacheln -->
                <div id="internMitarbeiterSection">
                    <h3 class="intern-section-title">ğŸ‘· Mitarbeiter</h3>
                    <div id="internMitarbeiterKacheln" class="intern-team-grid">
                        <!-- Dynamisch befÃ¼llt -->
                        <div class="intern-loading">
                            <span class="loading-spinner"></span>
                            <span>Lade Team-Ãœbersicht...</span>
                        </div>
                    </div>
                </div>

                <!-- Alle Lehrlinge Kacheln -->
                <div id="internLehrlingeSection" style="margin-top: 30px;">
                    <h3 class="intern-section-title">ğŸ“ Lehrlinge</h3>
                    <div id="internLehrlingeKacheln" class="intern-team-grid">
                        <!-- Dynamisch befÃ¼llt -->
                    </div>
                    <div id="internKeineLehrlinge" class="intern-keine-auftraege" style="display: none;">
                        <span>ğŸ“­</span> Keine aktiven Lehrlinge
                    </div>
                </div>
            </div>

            <!-- Interne Termine Ãœbersicht wurde entfernt - Termine werden bei Terminplanung â†’ Intern verwaltet -->
        </template>

        <div id="papierkorb" class="tab-content" data-template-id="tab-template-papierkorb"></div>

        <template id="tab-template-papierkorb">
            <div class="page-header">
                <h2>ğŸ—‘ï¸ Papierkorb</h2>
                <p class="page-subtitle">GelÃ¶schte Termine wiederherstellen oder endgÃ¼ltig entfernen</p>
            </div>

            <div class="table-section">
                <table id="papierkorbTable">
                    <thead>
                        <tr>
                            <th>Termin-Nr</th>
                            <th>Datum</th>
                            <th>Kunde</th>
                            <th>Kennzeichen</th>
                            <th>Arbeit</th>
                            <th>Zeit</th>
                            <th>Mitarbeiter</th>
                            <th>GelÃ¶scht am</th>
                            <th>Aktionen</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </template>

    <!-- KI-Assistent Modal -->
    <div id="kiAssistentModal" class="modal">
        <div class="modal-content ki-modal-content">
            <span class="close" id="closeKiAssistent">&times;</span>
            <h3>ğŸ¤– KI-Assistent fÃ¼r Terminerfassung</h3>
            <p class="ki-modal-subtitle">Beschreibe den Termin in eigenen Worten - die KI analysiert und fÃ¼llt das Formular aus.</p>
            
            <!-- Freitext-Eingabe -->
            <div class="ki-eingabe-bereich">
                <label for="kiFreitextInput">ğŸ“ Termin-Beschreibung:</label>
                <textarea id="kiFreitextInput" class="ki-textarea" rows="4" 
                    placeholder="Beispiel: Herr MÃ¼ller kommt morgen um 10 Uhr mit seinem C3, Kennzeichen OSL-KI 123. Die Bremsen quietschen und er braucht auch einen Ã–lwechsel."></textarea>
                <div class="ki-beispiele">
                    <span class="ki-beispiel-label">Beispiele:</span>
                    <button type="button" class="ki-beispiel-btn" data-text="Frau Schmidt C4 Inspektion nÃ¤chste Woche Dienstag">Inspektion</button>
                    <button type="button" class="ki-beispiel-btn" data-text="Herr Meyer Berlingo - Klimaanlage kÃ¼hlt nicht mehr, bitte schnellstmÃ¶glich">Klimaproblem</button>
                    <button type="button" class="ki-beispiel-btn" data-text="C3 Aircross Bremsen vorne machen GerÃ¤usche">Bremsen</button>
                </div>
            </div>
            
            <!-- Analyse-Button -->
            <div class="ki-action-bereich">
                <button type="button" class="btn btn-primary ki-analysieren-btn" id="kiAnalysierenBtn">
                    <span class="ki-btn-icon">âœ¨</span>
                    <span class="ki-btn-text">Mit KI analysieren</span>
                </button>
                <div class="ki-loading" id="kiLoading" style="display: none;">
                    <div class="ki-spinner"></div>
                    <span>KI analysiert...</span>
                </div>
            </div>
            
            <!-- Ergebnis-Bereich -->
            <div class="ki-ergebnis-bereich" id="kiErgebnisBereich" style="display: none;">
                <h4>ğŸ“‹ Analysierte Daten:</h4>
                
                <!-- Fremdmarken-Warnung -->
                <div class="ki-fremdmarken-warnung" id="kiFremdmarkenWarnung" style="display: none;">
                    <span class="warnung-icon">âš ï¸</span>
                    <span class="warnung-text" id="kiFremdmarkenText"></span>
                    <label class="bestandskunde-check">
                        <input type="checkbox" id="kiBestandskundeCheck">
                        <span>Ist Bestandskunde - trotzdem annehmen</span>
                    </label>
                </div>
                
                <!-- Erkannte Daten -->
                <div class="ki-daten-grid">
                    <div class="ki-daten-gruppe">
                        <span class="ki-label">ğŸ‘¤ Kunde:</span>
                        <span class="ki-wert" id="kiErgebnisKunde">-</span>
                    </div>
                    <div class="ki-daten-gruppe">
                        <span class="ki-label">ğŸš— Fahrzeug:</span>
                        <span class="ki-wert" id="kiErgebnisFahrzeug">-</span>
                    </div>
                    <div class="ki-daten-gruppe">
                        <span class="ki-label">ğŸ“… Datum:</span>
                        <span class="ki-wert" id="kiErgebnisDatum">-</span>
                    </div>
                    <div class="ki-daten-gruppe">
                        <span class="ki-label">ğŸ• Uhrzeit:</span>
                        <span class="ki-wert" id="kiErgebnisUhrzeit">-</span>
                    </div>
                    <div class="ki-daten-gruppe ki-daten-gruppe-full">
                        <span class="ki-label">ğŸ”§ Arbeiten:</span>
                        <div class="ki-arbeiten-liste" id="kiErgebnisArbeiten"></div>
                    </div>
                    <div class="ki-daten-gruppe ki-daten-gruppe-full">
                        <span class="ki-label">â±ï¸ GeschÃ¤tzte Dauer:</span>
                        <span class="ki-wert" id="kiErgebnisDauer">-</span>
                    </div>
                    <div class="ki-daten-gruppe ki-daten-gruppe-full" id="kiTeileBereich" style="display: none;">
                        <span class="ki-label">ğŸ”© Vermutete Teile:</span>
                        <div class="ki-teile-liste" id="kiErgebnisTeile"></div>
                    </div>
                </div>
                
                <!-- Confidence-Anzeige -->
                <div class="ki-confidence" id="kiConfidence">
                    <span class="confidence-label">Erkennungs-Sicherheit:</span>
                    <div class="confidence-bar">
                        <div class="confidence-fill" id="kiConfidenceFill"></div>
                    </div>
                    <span class="confidence-value" id="kiConfidenceValue">0%</span>
                </div>
            </div>
            
            <!-- Footer mit Buttons -->
            <div class="ki-modal-footer">
                <button type="button" class="btn btn-secondary" id="kiAbbrechen">Abbrechen</button>
                <button type="button" class="btn btn-success" id="kiUebernehmen" style="display: none;">
                    âœ“ In Formular Ã¼bernehmen
                </button>
            </div>
        </div>
    </div>

    <!-- Internen Termin bearbeiten Modal -->
    <div id="internTerminBearbeitenModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close" id="closeInternTerminBearbeiten">&times;</span>
            <h3>âœï¸ Internen Termin bearbeiten</h3>
            
            <form id="internTerminEditForm">
                <input type="hidden" id="internEdit_id">
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Interne Auftragsnummer (optional):</label>
                        <input type="text" id="internEdit_auftragsnummer" placeholder="z.B. INT-2026-001" maxlength="50">
                    </div>
                </div>

                <div class="form-group">
                    <label>Arbeitsumfang: *</label>
                    <textarea id="internEdit_arbeit" rows="4" required placeholder="z.B.&#10;Autoaufbereitung&#10;Waschen&#10;Polieren"></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Datum: *</label>
                        <input type="date" id="internEdit_datum" required>
                    </div>
                    <div class="form-group">
                        <label>GeschÃ¤tzte Zeit (Stunden):</label>
                        <input type="number" id="internEdit_zeit" min="0.25" step="0.25" placeholder="z.B. 2.5">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Startzeit (optional):</label>
                        <input type="text" id="internEdit_zeit_von" placeholder="HH:MM" pattern="[0-2][0-9]:[0-5][0-9]" maxlength="5" title="24h-Format (z.B. 08:00)" oninput="this.value = this.value.replace(/[^0-9:]/g, ''); if(this.value.length === 2 && !this.value.includes(':')) this.value += ':';" style="text-align: center;">
                    </div>
                    <div class="form-group">
                        <label>Fertig bis (optional):</label>
                        <input type="text" id="internEdit_zeit_bis" placeholder="HH:MM" pattern="[0-2][0-9]:[0-5][0-9]" maxlength="5" title="24h-Format (z.B. 12:00)" oninput="this.value = this.value.replace(/[^0-9:]/g, ''); if(this.value.length === 2 && !this.value.includes(':')) this.value += ':';" style="text-align: center;">
                    </div>
                </div>

                <div class="form-group">
                    <label>Dringlichkeit:</label>
                    <select id="internEdit_dringlichkeit">
                        <option value="">-- Keine Dringlichkeit --</option>
                        <option value="dringend">ğŸ”´ Dringend</option>
                        <option value="heute">ğŸŸ  Heute</option>
                        <option value="woche">ğŸŸ¡ Laufe der Woche</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Mitarbeiter/Lehrling zuordnen (optional):</label>
                    <select id="internEdit_mitarbeiter">
                        <option value="">-- Niemand zugeordnet --</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Notizen:</label>
                    <textarea id="internEdit_notizen" rows="2" placeholder="ZusÃ¤tzliche Informationen..."></textarea>
                </div>

                <div class="form-group">
                    <label>Status:</label>
                    <select id="internEdit_status">
                        <option value="offen">ğŸ“‹ Offen</option>
                        <option value="in_arbeit">ğŸ”§ In Arbeit</option>
                        <option value="abgeschlossen">âœ“ Erledigt</option>
                    </select>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-primary">ğŸ’¾ Speichern</button>
                    <button type="button" class="btn btn-secondary" onclick="app.closeInternTerminBearbeitenModal()">Abbrechen</button>
                    <button type="button" class="btn btn-danger" onclick="app.deleteInternerTerminFromModal()" style="margin-left: auto;">ğŸ—‘ï¸ LÃ¶schen</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Fahrzeug-Auswahl Modal -->
    <div id="fahrzeugAuswahlModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <span class="close" id="closeFahrzeugAuswahl">&times;</span>
            <h3>ğŸš— Fahrzeug auswÃ¤hlen</h3>
            <p id="fahrzeugAuswahlKunde" style="color: #666; margin-bottom: 15px;"></p>
            <div id="fahrzeugAuswahlListe" style="max-height: 400px; overflow-y: auto;"></div>
            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd; display: flex; gap: 10px;">
                <button type="button" class="btn btn-secondary" id="fahrzeugAuswahlZurueck">â† ZurÃ¼ck</button>
            </div>
        </div>
    </div>

    <!-- Fahrzeugverwaltung Modal -->
    <div id="fahrzeugVerwaltungModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close" id="closeFahrzeugVerwaltung">&times;</span>
            <h3>ğŸš— Fahrzeuge verwalten</h3>
            <p id="fahrzeugVerwaltungKunde" style="color: #666; margin-bottom: 15px;"></p>
            
            <!-- Fahrzeugliste -->
            <div id="fahrzeugVerwaltungListe" style="max-height: 300px; overflow-y: auto; margin-bottom: 20px;"></div>
            
            <!-- Neues Fahrzeug hinzufÃ¼gen -->
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border: 2px dashed #dee2e6;">
                <h4 style="margin: 0 0 15px 0; color: #4a90e2;">â• Neues Fahrzeug hinzufÃ¼gen</h4>
                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div class="form-group" style="margin: 0;">
                        <label style="font-size: 0.85em;">Kennzeichen: *</label>
                        <input type="text" id="neuesFahrzeugKennzeichen" placeholder="z.B. K-AB 1234" style="text-transform: uppercase;">
                    </div>
                    <div class="form-group" style="margin: 0;">
                        <label style="font-size: 0.85em;">Fahrzeugtyp:</label>
                        <input type="text" id="neuesFahrzeugTyp" placeholder="z.B. VW Golf">
                    </div>
                </div>
                <div class="form-group" style="margin: 10px 0 0 0;">
                    <label style="font-size: 0.85em;">VIN:</label>
                    <input type="text" id="neuesFahrzeugVin" placeholder="z.B. WVWZZZ3CZWE123456" maxlength="17" style="text-transform: uppercase;">
                </div>
                <button type="button" class="btn btn-success" id="fahrzeugHinzufuegenBtn" style="margin-top: 10px;">
                    â• Fahrzeug hinzufÃ¼gen
                </button>
            </div>
            
            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;">
                <button type="button" class="btn btn-secondary" id="fahrzeugVerwaltungSchliessen">SchlieÃŸen</button>
            </div>
        </div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>Zeit anpassen</h3>
            <form id="zeitAnpassungForm">
                <input type="hidden" id="termin_id">
                <div class="form-group">
                    <label>TatsÃ¤chliche Zeit (Minuten):</label>
                    <input type="number" id="tatsaechliche_zeit" required min="1">
                </div>
                <div class="form-group">
                    <label>Status:</label>
                    <select id="status">
                        <option value="geplant">Geplant</option>
                        <option value="in_arbeit">In Arbeit</option>
                        <option value="abgeschlossen">Abgeschlossen</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Speichern</button>
            </form>
        </div>
    </div>

    <div id="terminDetailsModal" class="modal">
        <div class="modal-content">
            <span class="close" id="closeDetails">&times;</span>
            <h3>Termin-Details</h3>
            <div id="terminDetailsBody"></div>
            <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd; display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="btn btn-secondary" id="terminSchwebendBtn" onclick="app.toggleTerminSchwebend()">
                    â¸ï¸ Schwebend
                </button>
                <button class="btn btn-secondary" id="terminSplitBtn" onclick="app.openSplitModal()">
                    âœ‚ï¸ Aufteilen
                </button>
                <button class="btn btn-primary" id="terminErweiternBtn" onclick="app.openErweiterungModal()">
                    â• Auftrag erweitern
                </button>
                <button class="btn btn-danger" id="terminLoeschenBtn" onclick="app.deleteTerminFromDetails()">
                    ğŸ—‘ï¸ LÃ¶schen
                </button>
            </div>
        </div>
    </div>

    <!-- Auftragserweiterung Modal -->
    <div id="erweiterungModal" class="modal">
        <div class="modal-content erweiterung-modal-content">
            <span class="close" id="closeErweiterungModal">&times;</span>
            <h3>â• Auftrag erweitern</h3>
            
            <div id="erweiterungModalBody">
                <!-- Original-Termin Info -->
                <div class="erweiterung-info-box" id="erweiterungOriginalInfo">
                    <strong>ğŸ« Original-Termin</strong>
                    <div id="erweiterungTerminDetails"></div>
                </div>
                
                <!-- Bestehende Erweiterungen (wird dynamisch befÃ¼llt) -->
                <div class="erweiterung-info-box erweiterung-bestehende" id="erweiterungBestehendeBox" style="display: none;">
                    <strong>ğŸ”— Bereits vorhandene Erweiterungen</strong>
                    <div id="erweiterungBestehendeListe"></div>
                </div>

                <!-- Neue Arbeit eingeben -->
                <div class="form-section erweiterung-section">
                    <h4>ğŸ”§ Neue Arbeit hinzufÃ¼gen</h4>
                    <div class="form-group">
                        <label for="erweiterungNeueArbeit">Arbeitsbeschreibung *</label>
                        <textarea id="erweiterungNeueArbeit" rows="3" placeholder="z.B. Bremsen hinten wechseln, Ã–lwechsel..."></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="erweiterungArbeitszeit">Arbeitszeit (Stunden) *</label>
                            <input type="number" id="erweiterungArbeitszeit" min="0.1" step="0.25" value="0.5" 
                                   oninput="app.updateErweiterungVorschau()">
                        </div>
                        <div class="form-group">
                            <label for="erweiterungTeileStatus">Teile-Status</label>
                            <select id="erweiterungTeileStatus">
                                <option value="vorraetig">âœ… VorrÃ¤tig</option>
                                <option value="bestellen">ğŸ›’ MÃ¼ssen bestellt werden</option>
                                <option value="bestellt">ğŸ“¦ Bereits bestellt</option>
                                <option value="eingetroffen">ğŸ“¬ Eingetroffen</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Arbeitsbeginn Optionen -->
                <div class="form-section erweiterung-section">
                    <h4>ğŸ“… Wann soll die Arbeit erledigt werden?</h4>
                    
                    <div class="erweiterung-optionen">
                        <!-- Option 1: Im Anschluss -->
                        <div class="erweiterung-option" id="optionAnschluss">
                            <input type="radio" name="erweiterungTyp" id="typAnschluss" value="anschluss" checked 
                                   onchange="app.updateErweiterungTyp()">
                            <label for="typAnschluss">
                                <span class="option-icon">â©</span>
                                <span class="option-title">Im Anschluss</span>
                                <span class="option-desc">Direkt nach dem aktuellen Termin</span>
                            </label>
                        </div>

                        <!-- Option 2: Morgen -->
                        <div class="erweiterung-option" id="optionMorgen">
                            <input type="radio" name="erweiterungTyp" id="typMorgen" value="morgen"
                                   onchange="app.updateErweiterungTyp()">
                            <label for="typMorgen">
                                <span class="option-icon">ğŸŒ…</span>
                                <span class="option-title">Morgen</span>
                                <span class="option-desc" id="morgenDatumAnzeige">NÃ¤chster Arbeitstag</span>
                            </label>
                        </div>

                        <!-- Option 3: Datum wÃ¤hlen -->
                        <div class="erweiterung-option" id="optionDatum">
                            <input type="radio" name="erweiterungTyp" id="typDatum" value="datum"
                                   onchange="app.updateErweiterungTyp()">
                            <label for="typDatum">
                                <span class="option-icon">ğŸ“†</span>
                                <span class="option-title">Datum & Uhrzeit</span>
                                <span class="option-desc">Selbst festlegen</span>
                            </label>
                        </div>
                    </div>

                    <!-- Datum/Uhrzeit Auswahl (nur bei Option 3) -->
                    <div class="erweiterung-datum-auswahl" id="erweiterungDatumAuswahl" style="display: none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="erweiterungDatum">Datum *</label>
                                <input type="date" id="erweiterungDatum">
                            </div>
                            <div class="form-group">
                                <label for="erweiterungUhrzeit">Uhrzeit (optional)</label>
                                <input type="text" id="erweiterungUhrzeit" placeholder="HH:MM" pattern="[0-2][0-9]:[0-5][0-9]" maxlength="5" title="24h-Format oder leer fÃ¼r erste freie Zeit" oninput="this.value = this.value.replace(/[^0-9:]/g, ''); if(this.value.length === 2 && !this.value.includes(':')) this.value += ':';" style="text-align: center;">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Konflikt-Anzeige -->
                <div class="erweiterung-konflikte" id="erweiterungKonflikte" style="display: none;">
                    <div class="konflikt-header">
                        <span class="konflikt-icon">âš ï¸</span>
                        <span class="konflikt-title">Terminkonflikt erkannt</span>
                    </div>
                    <div class="konflikt-body" id="konfliktDetails"></div>
                    
                    <!-- Mitarbeiter-Auswahl bei Konflikt -->
                    <div class="konflikt-optionen" id="konfliktOptionen">
                        <div class="konflikt-option">
                            <input type="radio" name="konfliktLoesung" id="loesungGleicherMA" value="gleicher" checked
                                   onchange="app.updateKonfliktLoesung()">
                            <label for="loesungGleicherMA">
                                <strong>Gleicher Mitarbeiter</strong>
                                <span>Alle Folgetermine werden verschoben</span>
                            </label>
                        </div>
                        <div class="konflikt-option">
                            <input type="radio" name="konfliktLoesung" id="loesungAndererMA" value="anderer"
                                   onchange="app.updateKonfliktLoesung()">
                            <label for="loesungAndererMA">
                                <strong>Anderer Mitarbeiter</strong>
                                <span>Erweiterung als separater Termin</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- VerfÃ¼gbare Mitarbeiter (wenn anderer MA gewÃ¤hlt) -->
                    <div class="verfuegbare-mitarbeiter" id="verfuegbareMitarbeiter" style="display: none;">
                        <label>VerfÃ¼gbare Mitarbeiter:</label>
                        <select id="erweiterungMitarbeiterSelect">
                            <option value="">Wird geladen...</option>
                        </select>
                        <div class="verfuegbarkeit-info" id="verfuegbarkeitInfo"></div>
                    </div>
                </div>

                <!-- Smart-VorschlÃ¤ge -->
                <div class="erweiterung-vorschlaege" id="erweiterungVorschlaege" style="display: none;">
                    <h5>ğŸ’¡ VorschlÃ¤ge</h5>
                    <div id="vorschlaegeContent"></div>
                </div>

                <!-- Vorschau -->
                <div class="erweiterung-vorschau" id="erweiterungVorschau">
                    <h5>ğŸ“‹ Vorschau</h5>
                    <div class="vorschau-grid" id="vorschauContent">
                        <div class="vorschau-item">
                            <span class="vorschau-label">Neue Arbeitszeit</span>
                            <span class="vorschau-value" id="erweiterungVorschauArbeitszeit">30 Min</span>
                        </div>
                        <div class="vorschau-item">
                            <span class="vorschau-label">Geplant fÃ¼r</span>
                            <span class="vorschau-value" id="erweiterungVorschauDatum">--</span>
                        </div>
                        <div class="vorschau-item">
                            <span class="vorschau-label">Mitarbeiter</span>
                            <span class="vorschau-value" id="erweiterungVorschauMitarbeiter">--</span>
                        </div>
                    </div>
                </div>

                <!-- Buttons -->
                <div class="erweiterung-actions">
                    <button class="btn btn-secondary" onclick="app.closeErweiterungModal()">
                        Abbrechen
                    </button>
                    <button class="btn btn-primary btn-sparkle" id="erweiterungSpeichernBtn" onclick="app.speichereErweiterung()">
                        <svg class="sparkle-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2L14.09 8.26L20 9.27L15.55 13.97L16.91 20L12 16.9L7.09 20L8.45 13.97L4 9.27L9.91 8.26L12 2Z" fill="currentColor"/>
                        </svg>
                        <span class="btn-text">Erweiterung erstellen</span>
                        <div class="dots-border"></div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Zeitleiste KontextmenÃ¼ -->
    <div id="zeitleisteKontextmenu" class="zeitleiste-kontextmenu" style="display: none;">
        <div class="zeitleiste-kontextmenu-header" id="zeitleisteKontextmenuHeader"></div>
        <div class="zeitleiste-kontextmenu-items">
            <button class="zeitleiste-kontextmenu-item" onclick="app.zeitleisteKontextZeiten()">
                <span class="icon">â±ï¸</span>
                <span>Zeiten festlegen</span>
            </button>
            <button class="zeitleiste-kontextmenu-item" onclick="app.zeitleisteKontextSplit()">
                <span class="icon">âœ‚ï¸</span>
                <span>Termin aufteilen</span>
            </button>
            <button class="zeitleiste-kontextmenu-item" onclick="app.zeitleisteKontextErweitern()">
                <span class="icon">â•</span>
                <span>Auftrag erweitern</span>
            </button>
            <button class="zeitleiste-kontextmenu-item" onclick="app.zeitleisteKontextDetails()">
                <span class="icon">ğŸ“‹</span>
                <span>Termin-Details</span>
            </button>
            <div style="border-top: 1px solid #e0e0e0; margin: 5px 0;"></div>
            <button class="zeitleiste-kontextmenu-item zeitleiste-kontextmenu-item-danger" onclick="app.zeitleisteKontextLoeschen()">
                <span class="icon">ğŸ—‘ï¸</span>
                <span>LÃ¶schen</span>
            </button>
        </div>
    </div>

    <!-- Termin-Split Modal -->
    <div id="terminSplitModal" class="modal">
        <div class="modal-content">
            <span class="close" id="closeSplitModal">&times;</span>
            <h3>âœ‚ï¸ Termin aufteilen</h3>
            <div id="terminSplitBody">
                <p style="color: #666; margin-bottom: 20px;">
                    Teilen Sie den Termin auf, wenn die Arbeit nicht an einem Tag abgeschlossen werden kann. 
                    Der Rest wird auf einen anderen Tag verschoben.
                </p>
                
                <div class="split-info-box" style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <strong>Original-Termin:</strong>
                    <div id="splitTerminInfo"></div>
                    <div style="margin-top: 10px;">
                        <strong>Gesamtzeit:</strong> <span id="splitGesamtzeit">0 Min.</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="splitTeil1Zeit"><strong>Zeit fÃ¼r Tag 1 (heute):</strong></label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="number" id="splitTeil1Zeit" min="1" style="width: 100px; padding: 8px;">
                        <span>Minuten</span>
                        <input type="range" id="splitTeil1Range" min="0" max="100" value="50" 
                               style="flex: 1;" oninput="app.updateSplitPreview()">
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 15px;">
                    <label for="splitTeil2Datum"><strong>Datum fÃ¼r Restarbeit:</strong></label>
                    <input type="date" id="splitTeil2Datum" style="width: 100%; padding: 8px;">
                </div>
                
                <div class="form-group" style="margin-top: 15px;">
                    <label><strong>Zeit fÃ¼r Tag 2 (Rest):</strong></label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="number" id="splitTeil2Zeit" min="1" style="width: 100px; padding: 8px;" readonly>
                        <span>Minuten</span>
                    </div>
                </div>
                
                <div class="split-preview" style="margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 8px;">
                    <h4 style="margin-top: 0;">Vorschau:</h4>
                    <div style="display: flex; gap: 20px;">
                        <div style="flex: 1; padding: 10px; background: #fff; border-radius: 5px; border-left: 4px solid #2196f3;">
                            <strong>Teil 1</strong><br>
                            <span id="splitPreviewTeil1">0 Min.</span>
                        </div>
                        <div style="flex: 1; padding: 10px; background: #fff; border-radius: 5px; border-left: 4px solid #ff9800;">
                            <strong>Teil 2</strong><br>
                            <span id="splitPreviewTeil2">0 Min.</span>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button class="btn btn-primary" onclick="app.executeSplit()">
                        âœ‚ï¸ Termin aufteilen
                    </button>
                    <button class="btn btn-secondary" onclick="app.closeSplitModal()">
                        Abbrechen
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- TagesÃ¼bersicht Popup -->
    <div id="tagesUebersichtModal" class="modal">
        <div class="modal-content tages-modal-content">
            <span class="close" id="closeTagesUebersicht">&times;</span>
            <div class="tages-modal-header">
                <h3 id="tagesUebersichtTitel">ğŸ“… Termine am --</h3>
                <div class="tages-modal-stats">
                    <span class="stat-badge" id="tagesTermineCount">0 Termine</span>
                    <span class="stat-badge auslastung" id="tagesAuslastung">0% Auslastung</span>
                </div>
            </div>
            <div id="tagesUebersichtBody" class="tages-liste">
                <div class="loading">Termine werden geladen...</div>
            </div>
        </div>
    </div>

    <!-- Ãœberschneidungen Modal -->
    <div id="ueberschneidungenModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <span class="close" onclick="document.getElementById('ueberschneidungenModal').style.display='none'">&times;</span>
            <h3>ğŸ” TerminÃ¼berschneidungen prÃ¼fen</h3>
            <div id="ueberschneidungenBody">
                <div class="loading">PrÃ¼fe Termine...</div>
            </div>
            <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                <button type="button" class="btn btn-secondary" onclick="document.getElementById('ueberschneidungenModal').style.display='none'">
                    SchlieÃŸen
                </button>
                <button type="button" class="btn btn-primary" id="ueberschneidungenAlleAnwenden" style="display: none;" onclick="app.wendeAlleVorschlaegeAn()">
                    âœ… Alle VorschlÃ¤ge anwenden
                </button>
            </div>
        </div>
    </div>

    <div id="arbeitszeitenModal" class="modal">
        <div class="modal-content">
            <span class="close" id="closeArbeitszeitenModal">&times;</span>
            <h3>Zeiten fÃ¼r einzelne Arbeiten festlegen</h3>
            <div id="arbeitszeitenModalBody">
                <p><strong>Termin:</strong> <span id="modalTerminInfo"></span></p>
                <div id="modalArbeitszeitenListe" class="arbeitszeiten-grid" style="margin: 20px 0;"></div>
                <div style="margin-top: 10px; padding: 10px; background: #e8f5e9; border-radius: 5px;">
                    <strong>Gesamtzeit:</strong> <span id="modalGesamtzeit">0 h</span>
                </div>
                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 10px;">Mitarbeiter/Lehrling fÃ¼r gesamten Auftrag (optional):</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <select id="modalGesamtMitarbeiter" style="flex: 1; padding: 10px; font-size: 14px; border: 2px solid #ddd; border-radius: 5px;">
                            <option value="">-- Keine Zuordnung --</option>
                        </select>
                        <button type="button" class="btn btn-secondary" onclick="app.syncGesamtMitarbeiterToEinzelne(true)" style="white-space: nowrap; padding: 10px 15px;" title="Ãœbernimmt den ausgewÃ¤hlten Mitarbeiter fÃ¼r alle Arbeiten">
                            ğŸ“‹ Auf alle anwenden
                        </button>
                    </div>
                    <small style="display: block; color: #666; margin-top: 5px;">Klicke "Auf alle anwenden" um den Mitarbeiter bei allen Arbeiten einzutragen.</small>
                </div>
                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 10px;">Termin-Status:</label>
                    <select id="modalTerminStatus" style="width: 100%; padding: 10px; font-size: 14px; border: 2px solid #ddd; border-radius: 5px;">
                        <option value="geplant">Geplant</option>
                        <option value="in_arbeit">In Arbeit</option>
                        <option value="abgeschlossen">Abgeschlossen</option>
                    </select>
                </div>

                <!-- Phasen fÃ¼r mehrtÃ¤gige Arbeiten -->
                <div id="modalPhasenSection" style="margin-top: 20px; padding: 15px; background: #fff3e0; border-radius: 8px; border-left: 4px solid #ff9800; display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h4 style="margin: 0; color: #e65100;">ğŸ”§ Arbeitsphasen (mehrtÃ¤gig)</h4>
                        <button type="button" class="btn btn-secondary" id="modalAddPhaseBtn" style="padding: 5px 10px; font-size: 0.9em;">+ Phase hinzufÃ¼gen</button>
                    </div>
                    <p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">FÃ¼r Unfallreparaturen oder mehrtÃ¤gige Arbeiten: Jede Phase hat ein eigenes Datum fÃ¼r die Auslastung.</p>
                    <div id="modalPhasenListe"></div>
                    
                    <!-- Option fÃ¼r automatische Folgetermine -->
                    <div style="margin-top: 15px; padding: 12px; background: #e8f5e9; border-radius: 6px; border: 1px solid #a5d6a7;">
                        <label class="checkbox-inline" style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="modalErstelleFolgetermineCheckbox">
                            <span style="font-weight: 500; color: #2e7d32;">ğŸ“… Folgetermine fÃ¼r neue Phasen erstellen</span>
                        </label>
                        <p style="color: #666; font-size: 0.85em; margin: 8px 0 0 24px;">Erstellt separate Termine fÃ¼r neue Phasen (an anderen Tagen).</p>
                    </div>
                </div>

                <div style="margin-top: 15px;">
                    <label class="checkbox-inline">
                        <input type="checkbox" id="modalMehrtaegigCheckbox"> MehrtÃ¤gige Arbeit (Phasen aktivieren)
                    </label>
                </div>

                <!-- Interne Auftragsnummer -->
                <div style="margin-top: 20px; padding: 15px; background: #e3f2fd; border-radius: 8px; border-left: 4px solid #2196f3;">
                    <label style="display: block; font-weight: 600; margin-bottom: 10px; color: #1565c0;">ğŸ“‹ Interne Auftragsnummer:</label>
                    <input type="text" id="modalInterneAuftragsnummer" placeholder="z.B. A-2026-001" style="width: 100%; padding: 10px; font-size: 14px; border: 2px solid #ddd; border-radius: 5px;">
                    <small style="display: block; color: #666; margin-top: 5px;">Eigene Auftragsnummer fÃ¼r interne Zuordnung (optional).</small>
                </div>

                <!-- Bearbeitungs-Markierung -->
                <div style="margin-top: 20px; padding: 15px; background: #fff8e1; border-radius: 8px; border-left: 4px solid #ffc107;">
                    <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                        <input type="checkbox" id="modalMussBearbeitetCheckbox" style="width: 20px; height: 20px; cursor: pointer;">
                        <span style="font-weight: 600; color: #f57c00;">âœï¸ Muss noch bearbeitet werden</span>
                    </label>
                    <small style="display: block; color: #666; margin-top: 8px; margin-left: 32px;">Markiere diesen Termin, wenn noch Daten ergÃ¤nzt werden mÃ¼ssen. Erscheint dann bei "Offene Termine".</small>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button id="saveArbeitszeitenBtn" class="btn btn-primary" style="flex: 1;">Zeiten & Status speichern</button>
                    <button id="backToDetailsBtn" class="btn btn-secondary" style="flex: 0 0 auto;" onclick="app.backToTerminDetails()">â† ZurÃ¼ck zu Details</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Termin Vorschau Modal mit Countdown -->
    <div id="terminVorschauModal" class="modal-overlay" style="display: none;">
        <div class="modal-content termin-vorschau-modal" style="max-width: 600px;">
            <div class="modal-header" style="background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%); color: white; padding: 20px; border-radius: 8px 8px 0 0;">
                <h3 style="margin: 0; display: flex; align-items: center; gap: 10px;">
                    <span>ğŸ“‹</span> Termin-Zusammenfassung
                </h3>
            </div>
            <div class="modal-body" style="padding: 20px;">
                <!-- Countdown-Anzeige -->
                <div id="vorschauCountdown" style="text-align: center; margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-radius: 8px;">
                    <div style="font-size: 0.9em; color: #2e7d32; margin-bottom: 5px;">Wird automatisch gespeichert in</div>
                    <div id="countdownZahl" style="font-size: 3em; font-weight: bold; color: #1b5e20; line-height: 1;">5</div>
                    <div style="font-size: 0.85em; color: #388e3c; margin-top: 5px;">Sekunden</div>
                    <div class="countdown-bar" style="margin-top: 10px; background: #a5d6a7; border-radius: 5px; height: 8px; overflow: hidden;">
                        <div id="countdownBar" style="height: 100%; background: #2e7d32; width: 100%; transition: width 1s linear;"></div>
                    </div>
                </div>

                <!-- Zusammenfassung -->
                <div id="vorschauInhalt" style="background: #f8f9fa; border-radius: 8px; padding: 15px;">
                    <div class="vorschau-row" style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e9ecef;">
                        <span style="color: #666;">ğŸ‘¤ Kunde:</span>
                        <strong id="vorschauKunde">-</strong>
                    </div>
                    <div class="vorschau-row" style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e9ecef;">
                        <span style="color: #666;">ğŸ“ Telefon:</span>
                        <span id="vorschauTelefon">-</span>
                    </div>
                    <div class="vorschau-row" style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e9ecef;">
                        <span style="color: #666;">ğŸ“… Datum:</span>
                        <strong id="vorschauDatum">-</strong>
                    </div>
                    <div class="vorschau-row" style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e9ecef;">
                        <span style="color: #666;">ğŸš— Kennzeichen:</span>
                        <strong id="vorschauKennzeichen">-</strong>
                    </div>
                    <div class="vorschau-row" style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e9ecef;">
                        <span style="color: #666;">â±ï¸ GeschÃ¤tzte Zeit:</span>
                        <span id="vorschauZeit">-</span>
                    </div>
                    <div class="vorschau-row" style="padding: 8px 0; border-bottom: 1px solid #e9ecef;">
                        <span style="color: #666; display: block; margin-bottom: 5px;">ğŸ”§ Arbeiten:</span>
                        <div id="vorschauArbeiten" style="background: white; padding: 10px; border-radius: 6px; font-size: 0.95em;"></div>
                    </div>
                    <div class="vorschau-row" style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e9ecef;">
                        <span style="color: #666;">ğŸš™ Abholung:</span>
                        <span id="vorschauAbholung">-</span>
                    </div>
                    <div id="vorschauErsatzautoRow" class="vorschau-row" style="display: none; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e9ecef;">
                        <span style="color: #666;">ğŸš— Ersatzauto:</span>
                        <span id="vorschauErsatzauto" style="color: #e65100; font-weight: 600;">Ja</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="padding: 15px 20px; background: #f8f9fa; border-radius: 0 0 8px 8px; display: flex; justify-content: space-between; gap: 10px;">
                <button id="vorschauAbbrechenBtn" class="btn btn-danger" style="flex: 1;">
                    âŒ Abbrechen
                </button>
                <button id="vorschauSofortSpeichernBtn" class="btn btn-success" style="flex: 2;">
                    âœ… Jetzt speichern
                </button>
            </div>
        </div>
    </div>

    <!-- Teile-Status Modal -->
    <div id="teileStatusModal" class="modal-overlay" style="display: none;">
        <div class="modal-content teile-status-modal" style="max-width: 400px;">
            <div class="modal-header" style="background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%); color: white; padding: 20px; border-radius: 8px 8px 0 0;">
                <h3 style="margin: 0; display: flex; align-items: center; gap: 10px;">
                    <span>ğŸ“¦</span> Teile-Status Ã¤ndern
                </h3>
                <button id="closeTeileStatusModal" class="modal-close-btn" style="position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.2); border: none; color: white; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-size: 18px;">&times;</button>
            </div>
            <div class="modal-body" style="padding: 20px;">
                <div id="teileStatusTerminInfo" style="margin-bottom: 20px; padding: 12px; background: #f5f5f5; border-radius: 8px; font-size: 0.95em;"></div>
                <div id="teileStatusAktuell" style="margin-bottom: 15px; text-align: center; padding: 10px; background: #e8f5e9; border-radius: 6px;"></div>
                <div class="teile-status-optionen" style="display: flex; flex-direction: column; gap: 10px;">
                    <button class="teile-status-btn" data-status="" style="padding: 15px; border: 2px solid #e0e0e0; background: white; border-radius: 8px; cursor: pointer; font-size: 1em; text-align: left; transition: all 0.2s;">
                        <span style="margin-right: 10px;">âŒ</span> Nicht relevant
                    </button>
                    <button class="teile-status-btn" data-status="bestellen" style="padding: 15px; border: 2px solid #ff9800; background: #fff3e0; border-radius: 8px; cursor: pointer; font-size: 1em; text-align: left; transition: all 0.2s;">
                        <span style="margin-right: 10px;">âš ï¸</span> Muss bestellt werden
                    </button>
                    <button class="teile-status-btn" data-status="bestellt" style="padding: 15px; border: 2px solid #2196f3; background: #e3f2fd; border-radius: 8px; cursor: pointer; font-size: 1em; text-align: left; transition: all 0.2s;">
                        <span style="margin-right: 10px;">ğŸ“¦</span> Teile bestellt
                    </button>
                    <button class="teile-status-btn" data-status="eingetroffen" style="padding: 15px; border: 2px solid #9c27b0; background: #f3e5f5; border-radius: 8px; cursor: pointer; font-size: 1em; text-align: left; transition: all 0.2s;">
                        <span style="margin-right: 10px;">ğŸšš</span> Teile eingetroffen
                    </button>
                    <button class="teile-status-btn" data-status="vorraetig" style="padding: 15px; border: 2px solid #4caf50; background: #e8f5e9; border-radius: 8px; cursor: pointer; font-size: 1em; text-align: left; transition: all 0.2s;">
                        <span style="margin-right: 10px;">âœ…</span> Teile vorrÃ¤tig
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- KI-Planungsvorschlag Modal -->
    <div id="kiPlanungModal" class="modal ki-modal" style="display: none;">
        <div class="modal-content ki-modal-content">
            <div class="modal-header ki-modal-header">
                <h2 id="kiModalTitle">ğŸ¤– KI-Planungsvorschlag</h2>
                <button class="modal-close" onclick="app.closeKIPlanungModal()">&times;</button>
            </div>
            <div class="modal-body ki-modal-body">
                <!-- Ladeindikator -->
                <div id="kiPlanungLoading" class="ki-loading">
                    <div class="ki-loading-spinner"></div>
                    <p>KI analysiert die Planung...</p>
                    <small>Dies kann einige Sekunden dauern</small>
                </div>
                
                <!-- Fehleranzeige -->
                <div id="kiPlanungError" class="ki-error" style="display: none;">
                    <span class="ki-error-icon">âŒ</span>
                    <p id="kiPlanungErrorText"></p>
                    <button class="btn btn-secondary" onclick="app.closeKIPlanungModal()">SchlieÃŸen</button>
                </div>
                
                <!-- Vorschlag-Inhalt -->
                <div id="kiPlanungContent" style="display: none;">
                    <!-- Zusammenfassung -->
                    <div class="ki-section ki-summary">
                        <h3>ğŸ“Š Analyse</h3>
                        <p id="kiZusammenfassung"></p>
                    </div>
                    
                    <!-- KapazitÃ¤tsanalyse -->
                    <div class="ki-section ki-capacity">
                        <h3>âš¡ KapazitÃ¤t</h3>
                        <div id="kiKapazitaet" class="ki-capacity-grid"></div>
                    </div>
                    
                    <!-- Warnungen -->
                    <div id="kiWarnungenSection" class="ki-section ki-warnings" style="display: none;">
                        <h3>âš ï¸ Hinweise</h3>
                        <ul id="kiWarnungen"></ul>
                    </div>
                    
                    <!-- Tages-Zuordnungen -->
                    <div id="kiTagesSection" class="ki-section" style="display: none;">
                        <h3>ğŸ“‹ Vorgeschlagene Zuordnungen fÃ¼r heute</h3>
                        <div id="kiTagesZuordnungen" class="ki-suggestions-list"></div>
                    </div>
                    
                    <!-- Schwebende Termine VorschlÃ¤ge -->
                    <div id="kiSchwebendeSection" class="ki-section" style="display: none;">
                        <h3>â¸ï¸ Schwebende Termine</h3>
                        <p class="ki-section-hint">Diese schwebenden Termine kÃ¶nnten heute eingeplant werden:</p>
                        <div id="kiSchwebendeVorschlaege" class="ki-suggestions-list"></div>
                    </div>
                    
                    <!-- Wochen-Verteilung -->
                    <div id="kiWochenSection" class="ki-section" style="display: none;">
                        <h3>ğŸ“… Wochenverteilung fÃ¼r schwebende Termine</h3>
                        <div id="kiWochenAuslastung" class="ki-week-overview"></div>
                        <div id="kiWochenVerteilung" class="ki-suggestions-list"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer ki-modal-footer" id="kiModalFooter" style="display: none;">
                <div class="ki-footer-left">
                    <button class="btn btn-sm btn-outline" onclick="app.kiSelectAll(true)" title="Alle auswÃ¤hlen">
                        â˜‘ï¸ Alle
                    </button>
                    <button class="btn btn-sm btn-outline" onclick="app.kiSelectAll(false)" title="Keine auswÃ¤hlen">
                        â¬œ Keine
                    </button>
                </div>
                <div class="ki-footer-right">
                    <button class="btn btn-secondary" onclick="app.closeKIPlanungModal()">
                        âŒ Verwerfen
                    </button>
                    <button class="btn btn-primary" id="kiAlleUebernehmenBtn" onclick="app.uebernehmeAlleKIVorschlaege()">
                        âœ… AusgewÃ¤hlte Ã¼bernehmen
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Neu-Einplanen Modal fÃ¼r Ã¼berfÃ¤llige Termine -->
    <div id="neuEinplanenModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 99999; overflow-y: auto; padding: 20px; box-sizing: border-box;">
        <div class="modal-content" style="max-width: 450px; width: 95%; margin: 20px auto; background: white; border-radius: 12px; box-shadow: 0 10px 50px rgba(0,0,0,0.3);">
            <div class="modal-header" style="background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%); color: white; border-radius: 12px 12px 0 0; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;">
                <h2 style="margin: 0; font-size: 1.2em;">
                    ğŸ“… Termin neu einplanen
                </h2>
                <button onclick="app.closeNeuEinplanenModal()" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 32px; height: 32px; border-radius: 50%; font-size: 20px; cursor: pointer;">&times;</button>
            </div>
            <div class="modal-body" style="padding: 20px;">
                <!-- Termin-Info -->
                <div style="background: #f5f5f5; border-radius: 8px; padding: 12px; margin-bottom: 15px;">
                    <div style="font-weight: 600; color: #333; margin-bottom: 5px;">
                        <span id="neuEinplanenKunde">Kunde</span>
                    </div>
                    <div style="font-size: 0.85em; color: #666;">
                        <span style="color: #1565c0; font-weight: 500;" id="neuEinplanenKennzeichen">K-XX 1234</span>
                        <span style="margin-left: 8px;" id="neuEinplanenArbeiten">Arbeiten...</span>
                    </div>
                    <div style="margin-top: 8px; font-size: 0.8em; color: #c62828;">
                        âš ï¸ Alt: <span id="neuEinplanenAltDatum">--</span>
                    </div>
                </div>
                
                <!-- Neues Datum -->
                <div style="margin-bottom: 15px;">
                    <label style="font-weight: 600; color: #333; display: block; margin-bottom: 5px; font-size: 0.9em;">
                        Neues Datum:
                    </label>
                    <input type="date" id="neuEinplanenDatum" style="width: 100%; padding: 10px; font-size: 1em; border: 2px solid #2196f3; border-radius: 8px; box-sizing: border-box;">
                </div>
                
                <!-- Schnellauswahl -->
                <div style="display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 15px;">
                    <button type="button" onclick="app.setNeuEinplanenDatum('heute')" 
                            style="background: #e3f2fd; color: #1976d2; border: 1px solid #2196f3; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 0.85em;">
                        ğŸ“… Heute
                    </button>
                    <button type="button" onclick="app.setNeuEinplanenDatum('morgen')"
                            style="background: #e8f5e9; color: #388e3c; border: 1px solid #4caf50; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 0.85em;">
                        â¡ï¸ Morgen
                    </button>
                    <button type="button" onclick="app.setNeuEinplanenDatum('naechsteWoche')"
                            style="background: #fff3e0; color: #f57c00; border: 1px solid #ff9800; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 0.85em;">
                        ğŸ“† NÃ¤chste Wo.
                    </button>
                </div>
                
                <!-- Status zurÃ¼cksetzen -->
                <div style="background: #e8f5e9; border-radius: 8px; padding: 10px; margin-bottom: 10px;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 0.9em;">
                        <input type="checkbox" id="neuEinplanenStatusReset" checked style="width: 18px; height: 18px;">
                        <span style="color: #2e7d32;">Status auf "Offen" zurÃ¼cksetzen</span>
                    </label>
                </div>
                
                <!-- Als "Nicht zugeordnet" einsortieren -->
                <div style="background: #e3f2fd; border-radius: 8px; padding: 10px; margin-bottom: 15px;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 0.9em;">
                        <input type="checkbox" id="neuEinplanenAlsSchwebend" checked style="width: 18px; height: 18px;">
                        <span style="color: #1565c0;">ğŸ“‹ In "Nicht zugeordnet" einsortieren</span>
                    </label>
                </div>
                
                <!-- BUTTONS -->
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="button" onclick="app.closeNeuEinplanenModal()" 
                            style="flex: 1; background: #9e9e9e; color: white; border: none; padding: 14px 10px; border-radius: 8px; cursor: pointer; font-size: 1em;">
                        âŒ Abbrechen
                    </button>
                    <button type="button" onclick="app.confirmNeuEinplanen()" 
                            style="flex: 1; background: #4caf50; color: white; border: none; padding: 14px 10px; border-radius: 8px; cursor: pointer; font-size: 1em; font-weight: 600;">
                        âœ… Ãœbernehmen
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal fÃ¼r Einplanen schwebender Termine -->
    <div id="schwebendEinplanenModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 99999; overflow-y: auto; padding: 20px; box-sizing: border-box; justify-content: center; align-items: flex-start;">
        <div class="modal-content" style="max-width: 450px; width: 95%; margin: 20px auto; background: white; border-radius: 12px; box-shadow: 0 10px 50px rgba(0,0,0,0.3);">
            <div class="modal-header" style="background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%); color: white; border-radius: 12px 12px 0 0; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;">
                <h2 style="margin: 0; font-size: 1.2em;">
                    ğŸ“… Schwebenden Termin einplanen
                </h2>
                <button onclick="app.closeSchwebendEinplanenModal()" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 32px; height: 32px; border-radius: 50%; font-size: 20px; cursor: pointer;">&times;</button>
            </div>
            <div class="modal-body" style="padding: 20px;">
                <!-- Termin-Info -->
                <div style="background: #f5f5f5; border-radius: 8px; padding: 12px; margin-bottom: 15px;">
                    <div style="font-weight: 600; color: #333; margin-bottom: 5px;">
                        <span id="schwebendEinplanenKunde">Kunde</span>
                    </div>
                    <div style="font-size: 0.85em; color: #666;">
                        <span style="color: #1565c0; font-weight: 500;" id="schwebendEinplanenKennzeichen">K-XX 1234</span>
                        <span style="margin-left: 8px;" id="schwebendEinplanenArbeiten">Arbeiten...</span>
                    </div>
                </div>
                
                <!-- Datum -->
                <div style="margin-bottom: 15px;">
                    <label style="font-weight: 600; color: #333; display: block; margin-bottom: 5px; font-size: 0.9em;">
                        Datum:
                    </label>
                    <input type="date" id="schwebendEinplanenDatum" style="width: 100%; padding: 10px; font-size: 1em; border: 2px solid #ff9800; border-radius: 8px; box-sizing: border-box;">
                </div>
                
                <!-- Schnellauswahl -->
                <div style="display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 15px;">
                    <button type="button" onclick="app.setSchwebendEinplanenDatum('heute')" 
                            style="background: #e3f2fd; color: #1976d2; border: 1px solid #2196f3; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 0.85em;">
                        ğŸ“… Heute
                    </button>
                    <button type="button" onclick="app.setSchwebendEinplanenDatum('morgen')"
                            style="background: #e8f5e9; color: #388e3c; border: 1px solid #4caf50; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 0.85em;">
                        â¡ï¸ Morgen
                    </button>
                    <button type="button" onclick="app.setSchwebendEinplanenDatum('naechsteWoche')"
                            style="background: #fff3e0; color: #f57c00; border: 1px solid #ff9800; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 0.85em;">
                        ğŸ“† NÃ¤chste Wo.
                    </button>
                </div>
                
                <!-- Option: In "Nicht zugeordnet" Box -->
                <div style="background: #e3f2fd; border-radius: 8px; padding: 10px; margin-bottom: 15px;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 0.9em;">
                        <input type="checkbox" id="schwebendEinplanenAlsSchwebend" checked style="width: 18px; height: 18px;">
                        <span style="color: #1565c0;">ğŸ“‹ In "Nicht zugeordnet" einplanen (per Drag&Drop zuweisbar)</span>
                    </label>
                </div>
                
                <!-- BUTTONS -->
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="button" onclick="app.closeSchwebendEinplanenModal()" 
                            style="flex: 1; background: #9e9e9e; color: white; border: none; padding: 14px 10px; border-radius: 8px; cursor: pointer; font-size: 1em;">
                        âŒ Abbrechen
                    </button>
                    <button type="button" onclick="app.confirmSchwebendEinplanen()" 
                            style="flex: 1; background: #ff9800; color: white; border: none; padding: 14px 10px; border-radius: 8px; cursor: pointer; font-size: 1em; font-weight: 600;">
                        âœ… Einplanen
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Vite Entry Point -->
    <script type="module" src="/src/main.js"></script>
</body>
</html>
